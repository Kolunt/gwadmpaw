{% extends "base.html" %}

{% block title %}{{ project_name }}{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-content">
        <h1 class="hero-title">{{ project_name }}</h1>
        <p class="hero-description">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ –ø–æ–¥–∞—Ä–∫–∞–º–∏! 
            –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –≤–æ–ª—à–µ–±—Å—Ç–≤—É –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.
        </p>
        {% if not session.user_id %}
        <div class="hero-actions">
            <a href="{{ url_for('login') }}" class="btn btn-primary btn-large">
                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ GWars
            </a>
            {% if request.host in ['127.0.0.1:5000', 'localhost:5000', '127.0.0.1', 'localhost'] %}
            <a href="{{ url_for('login_dev') }}" class="btn btn-secondary btn-large">
                –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            </a>
            {% endif %}
        </div>
        {% else %}
        <div class="hero-actions">
            <a href="{{ url_for('dashboard') }}" class="btn btn-primary btn-large">
                –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å
            </a>
        </div>
        {% endif %}
    </div>
</section>

<!-- Statistics Section -->
<section class="stats-section">
    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-content">
                    <div class="stat-number">{{ total_users }}</div>
                    <div class="stat-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üü¢</div>
                <div class="stat-content">
                    <div class="stat-number">{{ online_users }}</div>
                    <div class="stat-label">–û–Ω–ª–∞–π–Ω</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üéâ</div>
                <div class="stat-content">
                    <div class="stat-number">{{ events_with_stages|length }}</div>
                    <div class="stat-label">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Events Section -->
{% if events_with_stages %}
<section class="events-section">
    <div class="container">
        <h2 class="section-title">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
        <div class="events-grid">
            {% for item in events_with_stages[:3] %}
            <div class="event-card-home">
                <div class="event-card-header-home">
                    <h3 class="event-card-title">{{ item.event.name }}</h3>
                    {% if item.current_stage %}
                    <span class="event-stage-badge 
                        {% if item.current_stage.info.status == 'active' %}badge-active
                        {% elif item.current_stage.info.status == 'upcoming' %}badge-upcoming
                        {% else %}badge-past{% endif %}">
                        {{ item.current_stage.info.display_name }}
                    </span>
                    {% endif %}
                </div>
                {% if item.next_stage %}
                <div class="event-countdown-home" data-start="{{ item.next_stage.start_iso }}">
                    <div class="countdown-label">–î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞</div>
                    <div class="countdown-timer">
                        <div class="countdown-item">
                            <span class="countdown-value" data-unit="days">0</span>
                            <span class="countdown-unit">–¥–Ω–µ–π</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-value" data-unit="hours">00</span>
                            <span class="countdown-unit">—á–∞—Å–æ–≤</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-value" data-unit="minutes">00</span>
                            <span class="countdown-unit">–º–∏–Ω—É—Ç</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-value" data-unit="seconds">00</span>
                            <span class="countdown-unit">—Å–µ–∫—É–Ω–¥</span>
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="event-card-footer-home simplified-footer">
                    <div class="participant-count-icon">
                        <span class="participant-count">{{ item.registrations_count }}</span>
                        <span class="participant-label">—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                    </div>
                    <a href="{{ url_for('events') }}" class="btn btn-sm btn-outline">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% if events_with_stages|length > 3 %}
        <div class="section-footer">
            <a href="{{ url_for('events') }}" class="btn btn-primary">–í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</a>
        </div>
        {% else %}
        <div class="section-footer">
            <a href="{{ url_for('events') }}" class="btn btn-primary">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ</a>
        </div>
        {% endif %}
    </div>
</section>
{% endif %}

<!-- Features Section -->
<section class="features-section">
    <div class="container">
        <h2 class="section-title">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h2>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">üîê</div>
                <h3 class="feature-title">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
                <p class="feature-description">
                    –í—Ö–æ–¥ —á–µ—Ä–µ–∑ GWars –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
                </p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üéÅ</div>
                <h3 class="feature-title">–ê–Ω–æ–Ω–∏–º–Ω—ã–π –æ–±–º–µ–Ω</h3>
                <p class="feature-description">
                    –£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –æ–±–º–µ–Ω–µ –ø–æ–¥–∞—Ä–∫–∞–º–∏, —Å–æ—Ö—Ä–∞–Ω—è—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å –¥–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞
                </p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üéâ</div>
                <h3 class="feature-title">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>
                <p class="feature-description">
                    –ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ —É—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞—Ö
                </p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üë•</div>
                <h3 class="feature-title">–°–æ–æ–±—â–µ—Å—Ç–≤–æ</h3>
                <p class="feature-description">
                    –û–±—â–∞–π—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∏ –¥–µ–ª–∏—Ç–µ—Å—å –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º
                </p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
{% if not session.user_id %}
<section class="cta-section">
    <div class="container">
        <div class="cta-content">
            <h2 class="cta-title">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?</h2>
            <p class="cta-description">
                –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É –∏ —Å—Ç–∞–Ω—å—Ç–µ —á–∞—Å—Ç—å—é –≤–æ–ª—à–µ–±—Å—Ç–≤–∞ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤!
            </p>
            <a href="{{ url_for('login') }}" class="btn btn-primary btn-large">
                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ GWars
            </a>
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    function initCountdownTimers(selector) {
        const elements = document.querySelectorAll(selector);
        elements.forEach(element => {
            const targetIso = element.getAttribute('data-start');
            if (!targetIso) {
                return;
            }

            const targetDate = new Date(targetIso.replace(' ', 'T'));
            if (isNaN(targetDate.getTime())) {
                return;
            }

            const values = {
                days: element.querySelector('[data-unit="days"]'),
                hours: element.querySelector('[data-unit="hours"]'),
                minutes: element.querySelector('[data-unit="minutes"]'),
                seconds: element.querySelector('[data-unit="seconds"]')
            };

            let intervalId = null;

            function updateCountdown() {
                const now = new Date();
                const diff = targetDate - now;

                if (diff <= 0) {
                    values.days.textContent = '0';
                    values.hours.textContent = '00';
                    values.minutes.textContent = '00';
                    values.seconds.textContent = '00';
                    element.classList.add('countdown-complete');
                    if (intervalId !== null) {
                        clearInterval(intervalId);
                    }
                    return;
                }

                const seconds = Math.floor(diff / 1000) % 60;
                const minutes = Math.floor(diff / (1000 * 60)) % 60;
                const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));

                values.days.textContent = String(days);
                values.hours.textContent = String(hours).padStart(2, '0');
                values.minutes.textContent = String(minutes).padStart(2, '0');
                values.seconds.textContent = String(seconds).padStart(2, '0');
            }

            updateCountdown();
            intervalId = setInterval(updateCountdown, 1000);
        });
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
        initCountdownTimers('.event-countdown-home, .event-countdown');

        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
        
        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);
        
        document.querySelectorAll('.stat-card, .event-card-home, .feature-card').forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            observer.observe(card);
        });
    });
</script>
{% endblock %}
