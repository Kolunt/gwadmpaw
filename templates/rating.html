{% extends "base.html" %}

{% block title %}–†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="admin-container">
        <div class="admin-header">
            <div>
                <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h1>
            </div>
        </div>

        <div class="event-view-card">
            {% if rating_rows %}
            <div class="table-info" style="margin-bottom: 1rem;">
                <span>
                    –ü–æ–∫–∞–∑–∞–Ω–æ: <strong>{{ rating_rows|length }}</strong> –∏–∑ <strong>{{ total_count }}</strong>
                    {% if total_pages > 1 %}
                        (–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} –∏–∑ {{ total_pages }})
                    {% endif %}
                </span>
            </div>
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th style="width: 5rem;">–ú–µ—Å—Ç–æ</th>
                            <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                            <th style="width: 8rem;">–ë—É–±–µ–Ω—á–∏–∫–∏</th>
                            {% if is_admin %}
                            <th style="width: 10rem;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% set current_place = (page - 1) * per_page %}
                        {% set previous_score = None %}
                        {% for row in rating_rows %}
                            {% if previous_score != row.rating %}
                                {% set current_place = (page - 1) * per_page + loop.index %}
                                {% set previous_score = row.rating %}
                            {% endif %}
                        <tr>
                            <td data-label="–ú–µ—Å—Ç–æ">
                                <span class="badge badge-accent">{{ current_place }}</span>
                            </td>
                            <td data-label="–£—á–∞—Å—Ç–Ω–∏–∫">
                                <a href="{{ url_for('view_profile', user_id=row.user_id) }}" class="assignments-event-link">
                                    {{ row.username or ('ID ' ~ row.user_id) }}
                                </a>
                            </td>
                            <td data-label="–ë—É–±–µ–Ω—á–∏–∫–∏">
                                <strong>{{ row.rating|format_rating }}</strong>
                            </td>
                            {% if is_admin %}
                            <td data-label="–î–µ–π—Å—Ç–≤–∏—è">
                                <a href="{{ url_for('admin_rating_detail', user_id=row.user_id) }}" class="btn btn-outline-secondary btn-sm">
                                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                </a>
                            </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            {% if total_pages > 1 %}
            <div class="rating-pagination">
                {% if has_prev %}
                <a href="{{ url_for('user_rating', page=page-1, per_page=per_page) }}" class="btn btn-outline-primary">
                    ‚Üê –ù–∞–∑–∞–¥
                </a>
                {% else %}
                <span class="btn btn-outline-secondary" style="opacity: 0.5; cursor: not-allowed; pointer-events: none;">‚Üê –ù–∞–∑–∞–¥</span>
                {% endif %}
                
                <span class="rating-pagination-info">
                    –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} –∏–∑ {{ total_pages }}
                </span>
                
                {% if has_next %}
                <a href="{{ url_for('user_rating', page=page+1, per_page=per_page) }}" class="btn btn-outline-primary">
                    –í–ø–µ—Ä—ë–¥ ‚Üí
                </a>
                {% else %}
                <span class="btn btn-outline-secondary" style="opacity: 0.5; cursor: not-allowed; pointer-events: none;">–í–ø–µ—Ä—ë–¥ ‚Üí</span>
                {% endif %}
            </div>
            {% endif %}
            {% else %}
            <div class="empty-state">
                <p>–ü–æ–∫–∞ –Ω–µ—á–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
