{% extends "base.html" %}

{% block title %}–†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="admin-container">
        <div class="admin-header">
            <div>
                <h1>üèÜ –†–µ–π—Ç–∏–Ω–≥ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h1>
                <p class="text-muted" style="margin: 0;">
                    –ö–∞–∂–¥–∞—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (Telegram, WhatsApp, Viber) –¥–æ–±–∞–≤–ª—è–µ—Ç +1 –∫ —Ä–µ–π—Ç–∏–Ω–≥—É.
                </p>
            </div>
        </div>

        <div class="event-view-card">
            {% if rating_rows %}
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th style="width: 5rem;">–ú–µ—Å—Ç–æ</th>
                            <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                            <th style="width: 8rem;">–°–Ω–µ–∂–∏–Ω–∫–∏</th>
                            {% if is_admin %}
                            <th style="width: 10rem;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            {% endif %}
                        </tr>
                    </thead>
                    <tbody>
                        {% set current_place = 0 %}
                        {% set previous_score = None %}
                        {% for row in rating_rows %}
                            {% if previous_score != row.rating %}
                                {% set current_place = loop.index %}
                                {% set previous_score = row.rating %}
                            {% endif %}
                        <tr>
                            <td data-label="–ú–µ—Å—Ç–æ">
                                <span class="badge badge-accent">{{ current_place }}</span>
                            </td>
                            <td data-label="–£—á–∞—Å—Ç–Ω–∏–∫">
                                <a href="{{ url_for('view_profile', user_id=row.user_id) }}" class="assignments-event-link">
                                    {{ row.username or ('ID ' ~ row.user_id) }}
                                </a>
                            </td>
                            <td data-label="–°–Ω–µ–∂–∏–Ω–∫–∏">
                                <strong>{{ row.rating }}</strong>
                            </td>
                            {% if is_admin %}
                            <td data-label="–î–µ–π—Å—Ç–≤–∏—è">
                                <a href="{{ url_for('admin_rating_detail', user_id=row.user_id) }}" class="btn btn-outline-secondary btn-sm">
                                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                </a>
                            </td>
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <p>–ü–æ–∫–∞ –Ω–µ—á–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
