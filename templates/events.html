{% extends "base.html" %}

{% block title %}–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è - –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –î–µ–¥—ã –ú–æ—Ä–æ–∑—ã{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="admin-container">
        <div class="admin-header">
            <h1>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>
            {% if session.user_id and 'admin' in session.get('roles', []) %}
            <a href="{{ url_for('admin_events') }}" class="btn btn-primary">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º–∏</a>
            {% endif %}
        </div>
        
        {% if events_with_stages %}
        <div class="table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø</th>
                        <th>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —ç—Ç–∞–ø–∞</th>
                        <th>–£—á–∞—Å—Ç–Ω–∏–∫–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in events_with_stages %}
                    {% set event = item.event %}
                    {% set current_stage = item.current_stage %}
                    <tr>
                        <td data-label="–ù–∞–∑–≤–∞–Ω–∏–µ">
                            <strong>
                                <a href="{{ url_for('event_view', event_id=event.id) }}" style="color: var(--accent-color); text-decoration: none;">
                                    {{ event.name }}
                                </a>
                            </strong>
                        </td>
                        <td data-label="–¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø">
                            {% if current_stage %}
                                <span class="event-stage-badge badge-active">
                                    {{ current_stage.info.name }}
                                </span>
                            {% else %}
                                <span class="event-stage-badge badge-upcoming">
                                    –°–∫–æ—Ä–æ
                                </span>
                            {% endif %}
                        </td>
                        <td data-label="–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —ç—Ç–∞–ø–∞">
                            {% if current_stage and current_stage.data.start_datetime %}
                                {{ current_stage.data.start_datetime }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td data-label="–£—á–∞—Å—Ç–Ω–∏–∫–∏">
                            {{ item.registrations_count }} —É—á–∞—Å—Ç–Ω–∏–∫(–æ–≤)
                        </td>
                        <td data-label="–°—Ç–∞—Ç—É—Å">
                            {% if session.user_id %}
                                {% if item.is_registered %}
                                    <span class="badge-active">–£—á–∞—Å—Ç–≤—É—é</span>
                                {% else %}
                                    <span class="badge-upcoming">–ù–µ —É—á–∞—Å—Ç–≤—É—é</span>
                                {% endif %}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td data-label="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è">
                            {% if item.registration_open %}
                                <span class="badge-active">–û—Ç–∫—Ä—ã—Ç–∞</span>
                            {% else %}
                                <span class="badge-upcoming">–ó–∞–∫—Ä—ã—Ç–∞</span>
                            {% endif %}
                        </td>
                        <td data-label="–î–µ–π—Å—Ç–≤–∏—è">
                            <div class="action-buttons" style="display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-start;">
                                <a href="{{ url_for('event_view', event_id=event.id) }}" class="btn btn-sm btn-secondary" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                    <span style="font-size: 1.2em;">üëÅÔ∏è</span>
                                </a>
                                
                                {% if session.user_id %}
                                    {% if item.registration_open %}
                                        {% if item.is_registered %}
                                            <form method="POST" action="{{ url_for('event_unregister', event_id=event.id) }}" 
                                                  onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é?');" 
                                                  style="margin: 0;">
                                                <button type="submit" class="btn btn-sm btn-danger">–û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</button>
                                            </form>
                                        {% else %}
                                            <form method="POST" action="{{ url_for('event_register', event_id=event.id) }}" 
                                                  style="margin: 0;">
                                                <button type="submit" class="btn btn-sm btn-primary">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
                                            </form>
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                                
                                {% if session.user_id and 'admin' in session.get('roles', []) %}
                                    <a href="{{ url_for('admin_event_view', event_id=event.id) }}" class="btn btn-sm btn-secondary">–ê–¥–º–∏–Ω</a>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <p>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω—ã</p>
            {% if session.user_id and 'admin' in session.get('roles', []) %}
            <a href="{{ url_for('admin_event_create') }}" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

