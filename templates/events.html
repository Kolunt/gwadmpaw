{% extends "base.html" %}

{% block title %}Мероприятия - Анонимные Деды Морозы{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="admin-container">
        <div class="admin-header">
            <h1>Мероприятия</h1>
            {% if session.user_id and 'admin' in session.get('roles', []) %}
            <a href="{{ url_for('admin_events') }}" class="btn btn-primary">Управление мероприятиями</a>
            {% endif %}
        </div>
        
        {% if events_with_stages %}
        <div class="table-container">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Название</th>
                        <th>Описание</th>
                        <th>Организатор</th>
                        <th>Текущий этап</th>
                        <th>Дата начала этапа</th>
                        <th>Дата создания</th>
                        {% if session.user_id and 'admin' in session.get('roles', []) %}
                        <th>Действия</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for item in events_with_stages %}
                    {% set event = item.event %}
                    {% set current_stage = item.current_stage %}
                    <tr>
                        <td data-label="Название">
                            <strong>{{ event.name }}</strong>
                        </td>
                        <td data-label="Описание">
                            {% if event.description %}
                                {{ event.description[:100] }}{% if event.description|length > 100 %}...{% endif %}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td data-label="Организатор">
                            {{ event.creator_name or 'Не указан' }}
                        </td>
                        <td data-label="Текущий этап">
                            {% if current_stage %}
                                <span class="event-stage-badge badge-active">
                                    {{ current_stage.info.name }}
                                </span>
                            {% else %}
                                <span class="event-stage-badge badge-upcoming">
                                    Скоро
                                </span>
                            {% endif %}
                        </td>
                        <td data-label="Дата начала этапа">
                            {% if current_stage and current_stage.data.start_datetime %}
                                {{ current_stage.data.start_datetime }}
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td data-label="Дата создания">
                            {{ event.created_at or 'N/A' }}
                        </td>
                        {% if session.user_id and 'admin' in session.get('roles', []) %}
                        <td data-label="Действия">
                            <a href="{{ url_for('admin_event_view', event_id=event.id) }}" class="btn btn-sm btn-primary">Просмотр</a>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <p>Мероприятия пока не созданы</p>
            {% if session.user_id and 'admin' in session.get('roles', []) %}
            <a href="{{ url_for('admin_event_create') }}" class="btn btn-primary">Создать первое мероприятие</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

