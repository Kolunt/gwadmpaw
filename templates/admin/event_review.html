{% extends "base.html" %}

{% block title %}–†–µ–≤—å—é —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {{ event.name }} - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>–†–µ–≤—å—é —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤: {{ event.name }}</h1>
        <div class="action-buttons">
            <a href="{{ url_for('admin_event_view', event_id=event.id) }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—é</a>
            {% if approved_count >= 2 %}
            <a href="{{ url_for('admin_event_distribution', event_id=event.id) }}" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∂–µ—Ä–µ–±—å—ë–≤–∫–µ</a>
            {% endif %}
        </div>
    </div>
    
    <div class="event-view-card">
        <div class="settings-section">
            <h2 class="settings-section-title">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
            <p class="setting-hint" style="margin-bottom: 1.5rem;">
                –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —É—Ç–≤–µ—Ä–¥–∏—Ç–µ –∏—Ö –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏. 
                –ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é.
            </p>
            
            {% if participants %}
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ò–º—è</th>
                            <th>–§–ò–û</th>
                            <th>–ê–¥—Ä–µ—Å</th>
                            <th>–ö–æ–Ω—Ç–∞–∫—Ç—ã</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for participant in participants %}
                        <tr>
                            <td data-label="ID">{{ participant.user_id }}</td>
                            <td data-label="–ò–º—è">
                                <strong>{{ participant.username }}</strong><br>
                                <small style="color: var(--text-secondary);">–£—Ä–æ–≤–µ–Ω—å: {{ participant.level or '‚Äî' }}</small>
                            </td>
                            <td data-label="–§–ò–û">
                                {% if participant.last_name or participant.first_name or participant.middle_name %}
                                    {{ participant.last_name or '' }} {{ participant.first_name or '' }} {{ participant.middle_name or '' }}
                                {% else %}
                                    <span style="color: var(--text-secondary);">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                                {% endif %}
                            </td>
                            <td data-label="–ê–¥—Ä–µ—Å">
                                {% if participant.postal_code %}
                                    {{ participant.postal_code }}, 
                                    {{ participant.country or '' }}, 
                                    {{ participant.city or '' }}, 
                                    {{ participant.street or '' }}, 
                                    –¥. {{ participant.house or '' }}
                                    {% if participant.building %}, –∫–æ—Ä–ø. {{ participant.building }}{% endif %}
                                    {% if participant.apartment %}, –∫–≤. {{ participant.apartment }}{% endif %}
                                {% else %}
                                    <span style="color: var(--text-secondary);">–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>
                                {% endif %}
                            </td>
                            <td data-label="–ö–æ–Ω—Ç–∞–∫—Ç—ã">
                                {% if participant.email %}<div>üìß {{ participant.email }}</div>{% endif %}
                                {% if participant.phone %}<div>üì± {{ participant.phone }}</div>{% endif %}
                                {% if participant.telegram %}<div>üí¨ Telegram: {{ participant.telegram }}</div>{% endif %}
                                {% if participant.whatsapp %}<div>üì≤ WhatsApp: {{ participant.whatsapp }}</div>{% endif %}
                                {% if participant.viber %}<div>üì± Viber: {{ participant.viber }}</div>{% endif %}
                                {% if not participant.email and not participant.phone and not participant.telegram and not participant.whatsapp and not participant.viber %}
                                    <span style="color: var(--text-secondary);">–ù–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</span>
                                {% endif %}
                            </td>
                            <td data-label="–°—Ç–∞—Ç—É—Å">
                                {% if participant.approved %}
                                    <span class="badge badge-success">‚úì –£—Ç–≤–µ—Ä–∂–¥–µ–Ω</span>
                                    {% if participant.approved_at %}
                                    <br><small style="color: var(--text-secondary);">{{ participant.approved_at[:16] }}</small>
                                    {% endif %}
                                {% else %}
                                    <span class="badge badge-warning">‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>
                                {% endif %}
                            </td>
                            <td data-label="–î–µ–π—Å—Ç–≤–∏—è">
                                <form method="POST" action="{{ url_for('admin_event_approve', event_id=event.id) }}" style="display: inline;">
                                    <input type="hidden" name="user_id" value="{{ participant.user_id }}">
                                    {% if participant.approved %}
                                    <button type="submit" name="approved" value="0" class="btn btn-sm btn-warning" 
                                            onclick="return confirm('–û—Ç–º–µ–Ω–∏—Ç—å —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞?');">
                                        –û—Ç–º–µ–Ω–∏—Ç—å
                                    </button>
                                    {% else %}
                                    <button type="submit" name="approved" value="1" class="btn btn-sm btn-success">
                                        –£—Ç–≤–µ—Ä–¥–∏—Ç—å
                                    </button>
                                    {% endif %}
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                <p style="margin: 0;">
                    <strong>–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:</strong> {{ approved_count }} –∏–∑ {{ participants|length }} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                    {% if approved_count < 2 %}
                    <br><small style="color: var(--text-secondary);">–î–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Ç–≤–µ—Ä–¥–∏—Ç—å –º–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞</small>
                    {% endif %}
                </p>
            </div>
            {% else %}
            <div class="empty-state">
                <p>–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

