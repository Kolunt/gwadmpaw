{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h1>
        <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <form method="POST" class="settings-form" enctype="multipart/form-data">
        <!-- –¢–∞–±—ã -->
        <div class="settings-tabs">
            {% for category, settings in settings_by_category.items() %}
            <button 
                type="button" 
                class="settings-tab {% if loop.first %}active{% endif %}"
                data-tab="{{ category }}"
            >
                {% if category == 'gwars' %}
                    ‚öîÔ∏è GWars
                {% elif category == 'system' %}
                    üîß –°–∏—Å—Ç–µ–º–Ω—ã–µ
                {% else %}
                    üìã –û–±—â–∏–µ
                {% endif %}
            </button>
            {% endfor %}
        </div>
        
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤ -->
        {% for category, settings in settings_by_category.items() %}
        <div class="settings-tab-content {% if loop.first %}active{% endif %}" data-tab="{{ category }}">
            <div class="settings-section">
                <h2 class="settings-section-title">
                    {% if category == 'gwars' %}
                        ‚öîÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GWars
                    {% elif category == 'system' %}
                        üîß –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    {% else %}
                        üìã –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                    {% endif %}
                </h2>
                
                <div class="settings-grid">
                    {% for setting in settings %}
                    <div class="setting-item">
                        <label for="setting_{{ setting.key }}" class="setting-label">
                            {{ setting.description or setting.key }}
                            {% if setting.key == 'admin_user_ids' %}
                                <small class="setting-hint">ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 283494, 240139)</small>
                            {% elif setting.key == 'gwars_site_id' %}
                                <small class="setting-hint">–ß–∏—Å–ª–æ–≤–æ–π ID —Å–∞–π—Ç–∞ –≤ GWars</small>
                            {% elif setting.key == 'gwars_host' %}
                                <small class="setting-hint">–î–æ–º–µ–Ω –±–µ–∑ http:// (–Ω–∞–ø—Ä–∏–º–µ—Ä: gwadm.pythonanywhere.com)</small>
                            {% elif setting.key == 'default_theme' %}
                                <small class="setting-hint">–¢–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                            {% elif setting.key == 'site_icon' %}
                                <small class="setting-hint">–ò–∫–æ–Ω–∫–∞ —Å–∞–π—Ç–∞ (favicon). –§–æ—Ä–º–∞—Ç—ã: .ico, .png, .jpg, .svg</small>
                            {% elif setting.key == 'site_logo' %}
                                <small class="setting-hint">–õ–æ–≥–æ—Ç–∏–ø —Å–∞–π—Ç–∞. –§–æ—Ä–º–∞—Ç—ã: .png, .jpg, .svg, .gif, .webp</small>
                            {% endif %}
                        </label>
                        {% if setting.key == 'default_theme' %}
                        <select 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            class="setting-input"
                        >
                            <option value="light" {% if setting.value == 'light' %}selected{% endif %}>–°–≤–µ—Ç–ª–∞—è</option>
                            <option value="dark" {% if setting.value == 'dark' %}selected{% endif %}>–¢–µ–º–Ω–∞—è</option>
                        </select>
                        {% elif setting.key == 'site_icon' %}
                        <div class="file-upload-group">
                            {% if setting.value %}
                            <div class="current-file-preview">
                                <img src="{{ setting.value }}" alt="–¢–µ–∫—É—â–∞—è –∏–∫–æ–Ω–∫–∞" class="file-preview-icon">
                                <span class="current-file-label">–¢–µ–∫—É—â–∞—è –∏–∫–æ–Ω–∫–∞</span>
                            </div>
                            {% endif %}
                            <input 
                                type="file" 
                                id="site_icon" 
                                name="site_icon" 
                                accept=".ico,.png,.jpg,.jpeg,.svg"
                                class="file-input"
                            >
                            <label for="site_icon" class="file-upload-label">
                                <span class="file-upload-text">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                <span class="file-upload-btn">üìÅ</span>
                            </label>
                        </div>
                        {% elif setting.key == 'site_logo' %}
                        <div class="file-upload-group">
                            {% if setting.value %}
                            <div class="current-file-preview">
                                <img src="{{ setting.value }}" alt="–¢–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø" class="file-preview-logo">
                                <span class="current-file-label">–¢–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø</span>
                            </div>
                            {% endif %}
                            <input 
                                type="file" 
                                id="site_logo" 
                                name="site_logo" 
                                accept=".png,.jpg,.jpeg,.svg,.gif,.webp"
                                class="file-input"
                            >
                            <label for="site_logo" class="file-upload-label">
                                <span class="file-upload-text">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                <span class="file-upload-btn">üìÅ</span>
                            </label>
                        </div>
                        {% else %}
                        <input 
                            type="text" 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            value="{{ setting.value or '' }}"
                            class="setting-input"
                            {% if setting.key == 'gwars_site_id' %}pattern="[0-9]+"{% endif %}
                        >
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endfor %}
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.settings-tab');
    const tabContents = document.querySelectorAll('.settings-tab-content');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ç–∞–±—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
            this.classList.add('active');
            document.querySelector(`.settings-tab-content[data-tab="${targetTab}"]`).classList.add('active');
        });
    });
});
</script>
{% endblock %}

