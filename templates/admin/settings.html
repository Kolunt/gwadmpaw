{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h1>
        <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <form method="POST" class="settings-form" enctype="multipart/form-data">
        <!-- –¢–∞–±—ã -->
        <div class="settings-tabs">
            {% for category, settings in settings_by_category.items() %}
            {% if category != 'design' and category != 'modals' %}
            <a 
                href="{{ url_for('admin_settings') }}#{{ category }}"
                class="settings-tab {% if loop.first %}active{% endif %}"
                data-tab="{{ category }}"
            >
                {% if category == 'system' %}
                    üîß –ë–ª–∞—Ç–Ω—ã–µ
                {% elif category == 'integrations' %}
                    üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
                {% else %}
                    üìã –û–±—â–∏–µ
                {% endif %}
            </a>
            {% endif %}
            {% endfor %}
            <a 
                href="{{ url_for('admin_settings') }}#design"
                class="settings-tab"
                data-tab="design"
            >
                üé® –î–∏–∑–∞–π–Ω
            </a>
            <a 
                href="{{ url_for('admin_settings') }}#localization"
                class="settings-tab"
                data-tab="localization"
            >
                üåê –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
            </a>
            <a 
                href="{{ url_for('admin_settings') }}#modals"
                class="settings-tab"
                data-tab="modals"
            >
                üí¨ –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            </a>
        </div>
        
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤ -->
        {% for category, settings in settings_by_category.items() %}
        {% if category != 'design' and category != 'modals' %}
        <div class="settings-tab-content {% if loop.first %}active{% endif %}" data-tab="{{ category }}">
            {% if category == 'integrations' %}
            <!-- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π -->
            <div class="integrations-container">
                <!-- –ü–æ–¥—Ç–∞–±—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π -->
                <div class="integrations-subtabs">
                    <button type="button" class="integration-subtab active" data-integration="dadata">
                        üîç Dadata
                    </button>
                    <button type="button" class="integration-subtab" data-integration="smtp">
                        üìß SMTP
                    </button>
                    <button type="button" class="integration-subtab" data-integration="telegram">
                        ü§ñ Telegram
                    </button>
                </div>
                
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–¥—Ç–∞–±–æ–≤ -->
                <div class="integration-content active" data-integration="dadata">
                    <div class="settings-section">
                        <h2 class="settings-section-title">üîç –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Dadata</h2>
                        
                        {% set dadata_api_key = settings_dict.get('dadata_api_key', {}) %}
                        {% set dadata_secret_key = settings_dict.get('dadata_secret_key', {}) %}
                        {% set dadata_enabled = settings_dict.get('dadata_enabled', {}) %}
                        {% set dadata_verified = settings_dict.get('dadata_verified', {}) %}
                        
                        <div class="dadata-integration-form">
                            <div class="setting-item">
                                <label for="dadata_api_key" class="setting-label">
                                    API –∫–ª—é—á
                                    <small class="setting-hint">API –∫–ª—é—á –æ—Ç Dadata</small>
                                </label>
                                <input 
                                    type="text" 
                                    id="dadata_api_key" 
                                    name="setting_dadata_api_key" 
                                    value="{{ dadata_api_key.get('value', '') if dadata_api_key else '' }}"
                                    class="setting-input"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <label for="dadata_secret_key" class="setting-label">
                                    Secret –∫–ª—é—á
                                    <small class="setting-hint">Secret –∫–ª—é—á –æ—Ç Dadata</small>
                                </label>
                                <input 
                                    type="password" 
                                    id="dadata_secret_key" 
                                    name="setting_dadata_secret_key" 
                                    value="{{ dadata_secret_key.get('value', '') if dadata_secret_key else '' }}"
                                    class="setting-input"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ Secret –∫–ª—é—á"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <button type="button" id="verify-dadata-btn" class="btn btn-secondary">
                                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏
                                </button>
                                <span id="dadata-verify-status" class="verify-status"></span>
                            </div>
                            
                            <div class="setting-item">
                                <label for="dadata_enabled" class="setting-label">
                                    <input 
                                        type="checkbox" 
                                        id="dadata_enabled" 
                                        name="setting_dadata_enabled" 
                                        value="1"
                                        {% if dadata_enabled and dadata_enabled.get('value', '0') == '1' %}checked{% endif %}
                                        {% if not dadata_verified or dadata_verified.get('value', '0') != '1' %}disabled{% endif %}
                                        class="setting-checkbox"
                                        onchange="document.getElementById('dadata_enabled_hidden').value = this.checked ? '1' : '0';"
                                    >
                                    <input type="hidden" id="dadata_enabled_hidden" name="setting_dadata_enabled" value="{% if dadata_enabled and dadata_enabled.get('value', '0') == '1' %}1{% else %}0{% endif %}">
                                    <span>–í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Dadata</span>
                                    <small class="setting-hint">
                                        {% if not dadata_verified or dadata_verified.get('value', '0') != '1' %}
                                            –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏
                                        {% else %}
                                            –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞
                                        {% endif %}
                                    </small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–¥—Ç–∞–±–∞ SMTP -->
                <div class="integration-content" data-integration="smtp">
                    <div class="settings-section">
                        <h2 class="settings-section-title">üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP</h2>
                        
                        {% set smtp_host = settings_dict.get('smtp_host', {}) %}
                        {% set smtp_port = settings_dict.get('smtp_port', {}) %}
                        {% set smtp_username = settings_dict.get('smtp_username', {}) %}
                        {% set smtp_password = settings_dict.get('smtp_password', {}) %}
                        {% set smtp_use_tls = settings_dict.get('smtp_use_tls', {}) %}
                        {% set smtp_from_email = settings_dict.get('smtp_from_email', {}) %}
                        {% set smtp_from_name = settings_dict.get('smtp_from_name', {}) %}
                        {% set smtp_verified = settings_dict.get('smtp_verified', {}) %}
                        {% set smtp_enabled = settings_dict.get('smtp_enabled', {}) %}
                        
                        <div class="smtp-integration-form">
                            <div class="setting-item">
                                <label for="smtp_host" class="setting-label">
                                    SMTP —Å–µ—Ä–≤–µ—Ä
                                    <small class="setting-hint">–ê–¥—Ä–µ—Å SMTP —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: smtp.gmail.com)</small>
                                </label>
                                <input 
                                    type="text" 
                                    id="smtp_host" 
                                    name="setting_smtp_host" 
                                    value="{{ smtp_host.get('value', '') if smtp_host else '' }}"
                                    class="setting-input"
                                    placeholder="smtp.gmail.com"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <label for="smtp_port" class="setting-label">
                                    –ü–æ—Ä—Ç
                                    <small class="setting-hint">–ü–æ—Ä—Ç SMTP —Å–µ—Ä–≤–µ—Ä–∞ (–æ–±—ã—á–Ω–æ 587 –¥–ª—è TLS, 465 –¥–ª—è SSL, 25 –¥–ª—è –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è)</small>
                                </label>
                                <input 
                                    type="number" 
                                    id="smtp_port" 
                                    name="setting_smtp_port" 
                                    value="{{ smtp_port.get('value', '587') if smtp_port else '587' }}"
                                    class="setting-input"
                                    placeholder="587"
                                    min="1"
                                    max="65535"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <label for="smtp_username" class="setting-label">
                                    –õ–æ–≥–∏–Ω
                                    <small class="setting-hint">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SMTP (–æ–±—ã—á–Ω–æ email –∞–¥—Ä–µ—Å)</small>
                                </label>
                                <input 
                                    type="text" 
                                    id="smtp_username" 
                                    name="setting_smtp_username" 
                                    value="{{ smtp_username.get('value', '') if smtp_username else '' }}"
                                    class="setting-input"
                                    placeholder="user@example.com"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <label for="smtp_password" class="setting-label">
                                    –ü–∞—Ä–æ–ª—å
                                    <small class="setting-hint">–ü–∞—Ä–æ–ª—å –¥–ª—è SMTP (–¥–ª—è Gmail –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)</small>
                                </label>
                                <input 
                                    type="password" 
                                    id="smtp_password" 
                                    name="setting_smtp_password" 
                                    value="{{ smtp_password.get('value', '') if smtp_password else '' }}"
                                    class="setting-input"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <label for="smtp_use_tls" class="setting-label">
                                    <input 
                                        type="checkbox" 
                                        id="smtp_use_tls" 
                                        name="setting_smtp_use_tls" 
                                        value="1"
                                        {% if smtp_use_tls and smtp_use_tls.get('value', '0') == '1' %}checked{% endif %}
                                        class="setting-checkbox"
                                        onchange="document.getElementById('smtp_use_tls_hidden').value = this.checked ? '1' : '0';"
                                    >
                                    <input type="hidden" id="smtp_use_tls_hidden" name="setting_smtp_use_tls" value="{% if smtp_use_tls and smtp_use_tls.get('value', '0') == '1' %}1{% else %}0{% endif %}">
                                    <span>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS</span>
                                    <small class="setting-hint">
                                        –í–∫–ª—é—á–∏—Ç–µ –¥–ª—è –ø–æ—Ä—Ç–æ–≤ 587, –≤—ã–∫–ª—é—á–∏—Ç–µ –¥–ª—è –ø–æ—Ä—Ç–∞ 465 (SSL) –∏–ª–∏ 25
                                    </small>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <label for="smtp_from_email" class="setting-label">
                                    Email –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
                                    <small class="setting-hint">Email –∞–¥—Ä–µ—Å, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø–∏—Å—å–º–∞</small>
                                </label>
                                <input 
                                    type="email" 
                                    id="smtp_from_email" 
                                    name="setting_smtp_from_email" 
                                    value="{{ smtp_from_email.get('value', '') if smtp_from_email else '' }}"
                                    class="setting-input"
                                    placeholder="noreply@example.com"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <label for="smtp_from_name" class="setting-label">
                                    –ò–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
                                    <small class="setting-hint">–ò–º—è, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –ø–æ–ª–µ "–û—Ç"</small>
                                </label>
                                <input 
                                    type="text" 
                                    id="smtp_from_name" 
                                    name="setting_smtp_from_name" 
                                    value="{{ smtp_from_name.get('value', '–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –î–µ–¥—ã –ú–æ—Ä–æ–∑—ã') if smtp_from_name else '–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –î–µ–¥—ã –ú–æ—Ä–æ–∑—ã' }}"
                                    class="setting-input"
                                    placeholder="–ê–Ω–æ–Ω–∏–º–Ω—ã–µ –î–µ–¥—ã –ú–æ—Ä–æ–∑—ã"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <button type="button" id="verify-smtp-btn" class="btn btn-secondary">
                                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                                </button>
                                <span id="smtp-verify-status" class="verify-status"></span>
                            </div>
                            
                            <div class="setting-item">
                                <label for="smtp_enabled" class="setting-label">
                                    <input 
                                        type="checkbox" 
                                        id="smtp_enabled" 
                                        name="setting_smtp_enabled" 
                                        value="1"
                                        {% if smtp_enabled and smtp_enabled.get('value', '0') == '1' %}checked{% endif %}
                                        {% if not smtp_verified or smtp_verified.get('value', '0') != '1' %}disabled{% endif %}
                                        class="setting-checkbox"
                                        onchange="document.getElementById('smtp_enabled_hidden').value = this.checked ? '1' : '0';"
                                    >
                                    <input type="hidden" id="smtp_enabled_hidden" name="setting_smtp_enabled" value="{% if smtp_enabled and smtp_enabled.get('value', '0') == '1' %}1{% else %}0{% endif %}">
                                    <span>–í–∫–ª—é—á–∏—Ç—å SMTP</span>
                                    <small class="setting-hint">
                                        {% if not smtp_verified or smtp_verified.get('value', '0') != '1' %}
                                            –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                                        {% else %}
                                            SMTP –∞–∫—Ç–∏–≤–µ–Ω
                                        {% endif %}
                                    </small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–¥—Ç–∞–±–∞ Telegram -->
                <div class="integration-content" data-integration="telegram">
                    <div class="settings-section">
                        <h2 class="settings-section-title">ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram –±–æ—Ç–∞</h2>
                        
                        {% set telegram_bot_token = settings_dict.get('telegram_bot_token', {}) %}
                        {% set telegram_chat_id = settings_dict.get('telegram_chat_id', {}) %}
                        {% set telegram_verified = settings_dict.get('telegram_verified', {}) %}
                        {% set telegram_enabled = settings_dict.get('telegram_enabled', {}) %}
                        
                        <div class="telegram-integration-form">
                            <div class="setting-item">
                                <label for="telegram_bot_token" class="setting-label">
                                    –¢–æ–∫–µ–Ω –±–æ—Ç–∞
                                    <small class="setting-hint">–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather –≤ Telegram</small>
                                </label>
                                <input 
                                    type="password" 
                                    id="telegram_bot_token" 
                                    name="setting_telegram_bot_token" 
                                    value="{{ telegram_bot_token.get('value', '') if telegram_bot_token else '' }}"
                                    class="setting-input"
                                    placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <label for="telegram_chat_id" class="setting-label">
                                    Chat ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                                    <small class="setting-hint">ID —á–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ username</small>
                                </label>
                                <input 
                                    type="text" 
                                    id="telegram_chat_id" 
                                    name="setting_telegram_chat_id" 
                                    value="{{ telegram_chat_id.get('value', '') if telegram_chat_id else '' }}"
                                    class="setting-input"
                                    placeholder="@username –∏–ª–∏ -1001234567890"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <button type="button" id="verify-telegram-btn" class="btn btn-secondary">
                                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                                </button>
                                <span id="telegram-verify-status" class="verify-status"></span>
                            </div>
                            
                            <div class="setting-item">
                                <label for="telegram_enabled" class="setting-label">
                                    <input 
                                        type="checkbox" 
                                        id="telegram_enabled" 
                                        name="setting_telegram_enabled" 
                                        value="1"
                                        {% if telegram_enabled and telegram_enabled.get('value', '0') == '1' %}checked{% endif %}
                                        {% if not telegram_verified or telegram_verified.get('value', '0') != '1' %}disabled{% endif %}
                                        class="setting-checkbox"
                                        onchange="document.getElementById('telegram_enabled_hidden').value = this.checked ? '1' : '0';"
                                    >
                                    <input type="hidden" id="telegram_enabled_hidden" name="setting_telegram_enabled" value="{% if telegram_enabled and telegram_enabled.get('value', '0') == '1' %}1{% else %}0{% endif %}">
                                    <span>–í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Telegram</span>
                                    <small class="setting-hint">
                                        {% if not telegram_verified or telegram_verified.get('value', '0') != '1' %}
                                            –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                                        {% else %}
                                            Telegram –±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω
                                        {% endif %}
                                    </small>
                                </label>
                            </div>
                            
                            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞ –∏ –±–∞–∑–æ–≤–æ–≥–æ URL -->
                            <div class="setting-item" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color, #e0e0e0);">
                                <h3 style="margin-bottom: 1rem; color: var(--text-primary);">üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞</h3>
                                <p style="color: var(--text-secondary, #666); font-size: 0.9em; margin-bottom: 1rem;">
                                    –î–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–±—Ö—É–∫. URL –≤–µ–±—Ö—É–∫–∞:
                                </p>
                                <div style="padding: 1rem; background: var(--bg-secondary, #f5f5f5); border-radius: 6px; margin-bottom: 1rem;">
                                    <code id="webhook-url" style="font-size: 0.9em; word-break: break-all;">{{ request.host_url.rstrip('/') }}/telegram/webhook</code>
                                    <button type="button" class="btn btn-secondary" onclick="copyWebhookUrl()" style="margin-left: 1rem; padding: 0.5rem 1rem;">
                                        üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                                    </button>
                                </div>
                                <p style="color: var(--text-secondary, #666); font-size: 0.85em; margin-bottom: 1rem;">
                                    üí° –í–µ–±—Ö—É–∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–æ—Ç–∞. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é: /setwebhook –≤ @BotFather ‚Üí –≤—Å—Ç–∞–≤—å—Ç–µ URL –≤—ã—à–µ
                                </p>
                                
                                {% set site_url = settings_dict.get('site_url', {}) %}
                                <div class="setting-item" style="margin-top: 1rem;">
                                    <label for="site_url" class="setting-label">
                                        –ë–∞–∑–æ–≤—ã–π URL —Å–∞–π—Ç–∞
                                        <small class="setting-hint">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫ –≤ –±–æ—Ç–µ (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è)</small>
                                    </label>
                                    <input 
                                        type="text" 
                                        id="site_url" 
                                        name="setting_site_url" 
                                        value="{{ site_url.get('value', '') if site_url else '' }}"
                                        class="setting-input"
                                        placeholder="https://yourdomain.com"
                                    >
                                </div>
                            </div>
                        </div>
                        
                        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –±–æ—Ç–∞ -->
                        <div class="settings-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--border-color, #e0e0e0);">
                            <h2 class="settings-section-title">üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –±–æ—Ç–∞</h2>
                            <p style="color: var(--text-secondary, #666); margin-bottom: 1.5rem;">
                                –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ Telegram –±–æ—Ç–µ
                            </p>
                            
                            <div id="bot-menu-container">
                                <div style="margin-bottom: 1rem;">
                                    <button type="button" class="btn btn-primary" onclick="showMenuModal('create')">
                                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é
                                    </button>
                                </div>
                                
                                <div id="bot-menu-list" class="bot-menu-list">
                                    <!-- –°–ø–∏—Å–æ–∫ –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% elif category == 'system' %}
            <!-- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–ë–ª–∞—Ç–Ω—ã–µ) -->
            <div class="settings-section">
                <h2 class="settings-section-title">üîß –ë–ª–∞—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                
                <!-- –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
                <div class="setting-card" style="margin-bottom: 2rem;">
                    <div class="setting-card-header">
                        <label class="setting-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–∏—Å—Ç–µ–º—ã</label>
                        <span class="setting-badge">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </div>
                    <div class="setting-card-body">
                        <small class="setting-hint">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</small>
                        
                        {% if admin_users %}
                        <div class="admin-users-list" style="margin-top: 1rem;">
                            {% for admin_id in admin_users %}
                            <div class="admin-user-item" style="display: flex; align-items: center; padding: 0.75rem; margin-bottom: 0.5rem; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <div class="admin-user-id" style="font-weight: 600; font-size: 1.1rem; color: var(--accent-color); font-family: 'Courier New', monospace;">
                                    {{ admin_id }}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p style="color: var(--text-secondary); margin-top: 1rem;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π -->
                <div class="setting-card" style="margin-bottom: 2rem;">
                    <div class="setting-card-header">
                        <label class="setting-label">–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–æ–ª–∏</label>
                        <span class="setting-badge">–†–æ–ª–∏</span>
                    </div>
                    <div class="setting-card-body">
                        <small class="setting-hint">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–æ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</small>
                        
                        {% if system_roles %}
                        <div class="system-items-list" style="margin-top: 1rem;">
                            {% for role in system_roles %}
                            <div class="system-item" style="display: flex; align-items: center; padding: 0.75rem; margin-bottom: 0.5rem; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <div style="font-weight: 600; font-size: 1.1rem; color: var(--accent-color); font-family: 'Courier New', monospace; margin-right: 0.5rem;">
                                    {{ role.name }}
                                </div>
                                <div style="color: var(--text-primary);">
                                    {{ role.display_name }}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p style="color: var(--text-secondary); margin-top: 1rem;">–†–æ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–≤–∞–Ω–∏–π -->
                <div class="setting-card" style="margin-bottom: 2rem;">
                    <div class="setting-card-header">
                        <label class="setting-label">–°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–≤–∞–Ω–∏—è</label>
                        <span class="setting-badge">–ó–≤–∞–Ω–∏—è</span>
                    </div>
                    <div class="setting-card-body">
                        <small class="setting-hint">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–≤–∞–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</small>
                        
                        {% if system_titles %}
                        <div class="system-items-list" style="margin-top: 1rem;">
                            {% for title in system_titles %}
                            <div class="system-item" style="display: flex; align-items: center; padding: 0.75rem; margin-bottom: 0.5rem; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <div style="font-size: 1.3rem; margin-right: 0.75rem; line-height: 1;">
                                    {{ title.icon or 'üèÜ' }}
                                </div>
                                <div style="font-weight: 600; font-size: 1.1rem; color: var(--accent-color); font-family: 'Courier New', monospace; margin-right: 0.75rem; min-width: 120px;">
                                    {{ title.name }}
                                </div>
                                <div style="color: var(--text-primary); font-weight: 500;">
                                    {{ title.display_name }}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p style="color: var(--text-secondary); margin-top: 1rem;">–ó–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–∞–Ω–∏—è–º–∏ -->
                <div class="setting-card" style="margin-bottom: 2rem;">
                    <div class="setting-card-header">
                        <label class="setting-label">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–∞–Ω–∏—è–º–∏</label>
                        <span class="setting-badge">–ó–≤–∞–Ω–∏—è</span>
                    </div>
                    <div class="setting-card-body">
                        <small class="setting-hint">–°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤–∞–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                        
                        <div style="margin-top: 1rem; margin-bottom: 1rem;">
                            <a href="{{ url_for('admin_title_create') }}" class="btn btn-primary" style="display: inline-block;">
                                ‚ûï –°–æ–∑–¥–∞—Ç—å –∑–≤–∞–Ω–∏–µ
                            </a>
                        </div>
                        
                        {% if all_titles %}
                        <div class="table-container" style="margin-top: 1rem;">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>–ò–∫–æ–Ω–∫–∞</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è</th>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                        <th>–¶–≤–µ—Ç</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for title in all_titles %}
                                    <tr>
                                        <td data-label="–ò–∫–æ–Ω–∫–∞">
                                            {% if title.icon %}
                                            <span style="font-size: 1.5rem;">{{ title.icon }}</span>
                                            {% else %}
                                            <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td data-label="–ù–∞–∑–≤–∞–Ω–∏–µ"><code>{{ title.name }}</code></td>
                                        <td data-label="–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è">
                                            <span class="title-badge" style="background-color: {{ title.color }}20; color: {{ title.color }}; border-color: {{ title.color }};">
                                                {% if title.icon %}{{ title.icon }} {% endif %}{{ title.display_name }}
                                            </span>
                                        </td>
                                        <td data-label="–û–ø–∏—Å–∞–Ω–∏–µ">{{ title.description or '-' }}</td>
                                        <td data-label="–¶–≤–µ—Ç">
                                            <span style="display: inline-block; width: 30px; height: 30px; background-color: {{ title.color }}; border-radius: 4px; border: 1px solid var(--border-color);"></span>
                                            <code style="margin-left: 0.5rem;">{{ title.color }}</code>
                                        </td>
                                        <td data-label="–¢–∏–ø">
                                            {% if title.is_system %}
                                                <span class="badge badge-system">–°–∏—Å—Ç–µ–º–Ω–æ–µ</span>
                                            {% else %}
                                                <span class="badge badge-custom">–ö–∞—Å—Ç–æ–º–Ω–æ–µ</span>
                                            {% endif %}
                                        </td>
                                        <td data-label="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π">{{ title.user_count }}</td>
                                        <td data-label="–î–µ–π—Å—Ç–≤–∏—è">
                                            {% if not title.is_system %}
                                            <div style="display: flex; gap: 0.5rem;">
                                                <a href="{{ url_for('admin_title_edit', title_id=title.id) }}" class="btn-icon" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                                                <form method="POST" action="{{ url_for('admin_title_delete', title_id=title.id) }}" style="display: inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–≤–∞–Ω–∏–µ?');">
                                                    <button type="submit" class="btn-icon" title="–£–¥–∞–ª–∏—Ç—å" style="background-color: var(--error-color); color: white;">üóëÔ∏è</button>
                                                </form>
                                            </div>
                                            {% else %}
                                            <span class="text-muted">–°–∏—Å—Ç–µ–º–Ω–æ–µ</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <p style="color: var(--text-secondary); margin-top: 1rem;">–ó–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                <div class="settings-grid">
                    {% for setting in settings %}
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label for="setting_{{ setting.key }}" class="setting-label">
                                {{ setting.description or setting.key }}
                            </label>
                            {% if setting.key == 'admin_user_ids' %}
                                <span class="setting-badge">–°–∏—Å—Ç–µ–º–∞</span>
                            {% elif setting.key in ['default_theme', 'site_icon', 'site_logo', 'site_title', 'site_description', 'logo_text'] %}
                                <span class="setting-badge">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</span>
                            {% endif %}
                        </div>
                        <div class="setting-card-body">
                            {% if setting.key == 'admin_user_ids' %}
                                <small class="setting-hint">ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 283494, 240139)</small>
                            {% elif setting.key == 'default_theme' %}
                                <small class="setting-hint">–¢–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                            {% elif setting.key == 'site_icon' %}
                                <small class="setting-hint">–ò–∫–æ–Ω–∫–∞ —Å–∞–π—Ç–∞ (favicon). –§–æ—Ä–º–∞—Ç—ã: .ico, .png, .jpg, .svg</small>
                            {% elif setting.key == 'site_logo' %}
                                <small class="setting-hint">–õ–æ–≥–æ—Ç–∏–ø —Å–∞–π—Ç–∞. –§–æ—Ä–º–∞—Ç—ã: .png, .jpg, .svg, .gif, .webp</small>
                            {% elif setting.key == 'site_title' %}
                                <small class="setting-hint">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–∞–π—Ç–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–æ –≤–∫–ª–∞–¥–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞</small>
                            {% elif setting.key == 'site_description' %}
                                <small class="setting-hint">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º</small>
                            {% elif setting.key == 'logo_text' %}
                                <small class="setting-hint">–¢–µ–∫—Å—Ç, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ä—è–¥–æ–º —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –≤ —à–∞–ø–∫–µ —Å–∞–π—Ç–∞</small>
                            {% endif %}
                        {% if setting.key == 'default_theme' %}
                        <select 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            class="setting-input"
                        >
                            <option value="light" {% if setting.value == 'light' %}selected{% endif %}>–°–≤–µ—Ç–ª–∞—è</option>
                            <option value="dark" {% if setting.value == 'dark' %}selected{% endif %}>–¢–µ–º–Ω–∞—è</option>
                        </select>
                        {% elif setting.key == 'site_icon' %}
                        <input 
                            type="hidden" 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            value="üéÖ"
                        >
                        <p class="text-muted small-note">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —ç–º–æ–¥–∑–∏ üéÖ. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ.</p>
                        {% elif setting.key == 'site_logo' %}
                        <input 
                            type="hidden" 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            value="üéÖ"
                        >
                        <p class="text-muted small-note">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —ç–º–æ–¥–∑–∏ üéÖ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ª–æ–≥–æ—Ç–∏–ø–∞. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ.</p>
                        {% elif setting.key == 'site_description' %}
                        <textarea 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            rows="3"
                            class="setting-input"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞"
                        >{{ setting.value or '' }}</textarea>
                        {% else %}
                        <input 
                            type="text" 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            value="{{ setting.value or '' }}"
                            class="setting-input"
                        >
                        {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <!-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (general –∏ –¥—Ä—É–≥–∏—Ö) -->
            <div class="settings-grid">
                {% for setting in settings %}
                <div class="setting-card">
                    <div class="setting-card-header">
                        <label for="setting_{{ setting.key }}" class="setting-label">
                            {{ setting.description or setting.key }}
                        </label>
                        {% if setting.key == 'admin_user_ids' %}
                            <span class="setting-badge">–°–∏—Å—Ç–µ–º–∞</span>
                        {% elif setting.key in ['default_theme', 'site_icon', 'site_logo', 'site_title', 'site_description', 'logo_text'] %}
                            <span class="setting-badge">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</span>
                        {% endif %}
                    </div>
                    <div class="setting-card-body">
                        {% if setting.key == 'admin_user_ids' %}
                            <small class="setting-hint">ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 283494, 240139)</small>
                        {% elif setting.key == 'default_theme' %}
                            <small class="setting-hint">–¢–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                        {% elif setting.key == 'site_icon' %}
                            <small class="setting-hint">–ò–∫–æ–Ω–∫–∞ —Å–∞–π—Ç–∞ (favicon). –§–æ—Ä–º–∞—Ç—ã: .ico, .png, .jpg, .svg</small>
                        {% elif setting.key == 'site_logo' %}
                            <small class="setting-hint">–õ–æ–≥–æ—Ç–∏–ø —Å–∞–π—Ç–∞. –§–æ—Ä–º–∞—Ç—ã: .png, .jpg, .svg, .gif, .webp</small>
                        {% elif setting.key == 'site_title' %}
                            <small class="setting-hint">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–∞–π—Ç–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–æ –≤–∫–ª–∞–¥–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞</small>
                        {% elif setting.key == 'site_description' %}
                            <small class="setting-hint">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º</small>
                        {% elif setting.key == 'logo_text' %}
                            <small class="setting-hint">–¢–µ–∫—Å—Ç, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ä—è–¥–æ–º —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –≤ —à–∞–ø–∫–µ —Å–∞–π—Ç–∞</small>
                        {% endif %}
                        {% if setting.key == 'default_theme' %}
                        <select 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            class="setting-input"
                        >
                            <option value="light" {% if setting.value == 'light' %}selected{% endif %}>–°–≤–µ—Ç–ª–∞—è</option>
                            <option value="dark" {% if setting.value == 'dark' %}selected{% endif %}>–¢–µ–º–Ω–∞—è</option>
                        </select>
                        {% elif setting.key == 'site_icon' %}
                        <input 
                            type="hidden" 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            value="üéÖ"
                        >
                        <p class="text-muted small-note">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —ç–º–æ–¥–∑–∏ üéÖ. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ.</p>
                        {% elif setting.key == 'site_logo' %}
                        <input 
                            type="hidden" 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            value="üéÖ"
                        >
                        <p class="text-muted small-note">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —ç–º–æ–¥–∑–∏ üéÖ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ª–æ–≥–æ—Ç–∏–ø–∞. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ.</p>
                        {% elif setting.key == 'site_description' %}
                        <textarea 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            rows="3"
                            class="setting-input"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞"
                        >{{ setting.value or '' }}</textarea>
                        {% else %}
                        <input 
                            type="text" 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            value="{{ setting.value or '' }}"
                            class="setting-input"
                        >
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% endif %}
        {% endfor %}
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –¥–∏–∑–∞–π–Ω–∞ -->
        <div class="settings-tab-content" data-tab="design">
            <div class="settings-section">
                <h2 class="settings-section-title">üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–≤–µ—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h2>
                
                {% set accent_color = settings_dict.get('accent_color', {}) %}
                {% set accent_color_hover = settings_dict.get('accent_color_hover', {}) %}
                {% set accent_color_dark = settings_dict.get('accent_color_dark', {}) %}
                {% set accent_color_hover_dark = settings_dict.get('accent_color_hover_dark', {}) %}
                
                <div class="settings-grid">
                    <div class="setting-card color-picker-card">
                        <div class="setting-card-header">
                            <label for="setting_accent_color" class="setting-label">
                                –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç (—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞)
                            </label>
                            <span class="setting-badge">–¶–≤–µ—Ç–∞</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã. –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ color picker –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ hex-–∫–æ–¥ –≤—Ä—É—á–Ω—É—é.</small>
                            
                            <!-- –ü—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞ -->
                            <div class="color-preview" id="preview_accent_color" style="background-color: {{ accent_color.get('value', '#007bff') if accent_color else '#007bff' }};">
                                <span class="color-preview-text">{{ accent_color.get('value', '#007bff') if accent_color else '#007bff' }}</span>
                            </div>
                            
                            <!-- –ü–∞–ª–∏—Ç—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
                            <div class="color-palette">
                                <div class="color-palette-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞:</div>
                                <div class="color-palette-grid" data-target="setting_accent_color">
                                    <div class="color-palette-item" data-color="#007bff" style="background-color: #007bff;" title="–°–∏–Ω–∏–π (Blue)"></div>
                                    <div class="color-palette-item" data-color="#28a745" style="background-color: #28a745;" title="–ó–µ–ª–µ–Ω—ã–π (Green)"></div>
                                    <div class="color-palette-item" data-color="#dc3545" style="background-color: #dc3545;" title="–ö—Ä–∞—Å–Ω—ã–π (Red)"></div>
                                    <div class="color-palette-item" data-color="#ffc107" style="background-color: #ffc107;" title="–ñ–µ–ª—Ç—ã–π (Yellow)"></div>
                                    <div class="color-palette-item" data-color="#17a2b8" style="background-color: #17a2b8;" title="–ì–æ–ª—É–±–æ–π (Cyan)"></div>
                                    <div class="color-palette-item" data-color="#6f42c1" style="background-color: #6f42c1;" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π (Purple)"></div>
                                    <div class="color-palette-item" data-color="#e83e8c" style="background-color: #e83e8c;" title="–†–æ–∑–æ–≤—ã–π (Pink)"></div>
                                    <div class="color-palette-item" data-color="#fd7e14" style="background-color: #fd7e14;" title="–û—Ä–∞–Ω–∂–µ–≤—ã–π (Orange)"></div>
                                </div>
                            </div>
                            
                            <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                            <div class="color-input-group">
                                <input 
                                    type="color" 
                                    id="setting_accent_color" 
                                    value="{{ accent_color.get('value', '#007bff') if accent_color else '#007bff' }}"
                                    class="setting-input color-picker-input"
                                >
                                <input 
                                    type="text" 
                                    id="setting_accent_color_text" 
                                    name="setting_accent_color"
                                    value="{{ accent_color.get('value', '#007bff') if accent_color else '#007bff' }}"
                                    class="setting-input color-text-input"
                                    placeholder="#007bff"
                                    pattern="^#[0-9A-Fa-f]{6}$"
                                >
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-card color-picker-card">
                        <div class="setting-card-header">
                            <label for="setting_accent_color_hover" class="setting-label">
                                –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞)
                            </label>
                            <span class="setting-badge">–¶–≤–µ—Ç–∞</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ –∏ —Å—Å—ã–ª–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞)</small>
                            
                            <!-- –ü—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞ -->
                            <div class="color-preview" id="preview_accent_color_hover" style="background-color: {{ accent_color_hover.get('value', '#0056b3') if accent_color_hover else '#0056b3' }};">
                                <span class="color-preview-text">{{ accent_color_hover.get('value', '#0056b3') if accent_color_hover else '#0056b3' }}</span>
                            </div>
                            
                            <!-- –ü–∞–ª–∏—Ç—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
                            <div class="color-palette">
                                <div class="color-palette-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞:</div>
                                <div class="color-palette-grid" data-target="setting_accent_color_hover">
                                    <div class="color-palette-item" data-color="#0056b3" style="background-color: #0056b3;" title="–¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π"></div>
                                    <div class="color-palette-item" data-color="#1e7e34" style="background-color: #1e7e34;" title="–¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#c82333" style="background-color: #c82333;" title="–¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#e0a800" style="background-color: #e0a800;" title="–¢–µ–º–Ω–æ-–∂–µ–ª—Ç—ã–π"></div>
                                    <div class="color-palette-item" data-color="#138496" style="background-color: #138496;" title="–¢–µ–º–Ω–æ-–≥–æ–ª—É–±–æ–π"></div>
                                    <div class="color-palette-item" data-color="#5a32a3" style="background-color: #5a32a3;" title="–¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#c2185b" style="background-color: #c2185b;" title="–¢–µ–º–Ω–æ-—Ä–æ–∑–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#d68910" style="background-color: #d68910;" title="–¢–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                                </div>
                            </div>
                            
                            <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                            <div class="color-input-group">
                                <input 
                                    type="color" 
                                    id="setting_accent_color_hover" 
                                    value="{{ accent_color_hover.get('value', '#0056b3') if accent_color_hover else '#0056b3' }}"
                                    class="setting-input color-picker-input"
                                >
                                <input 
                                    type="text" 
                                    id="setting_accent_color_hover_text" 
                                    name="setting_accent_color_hover"
                                    value="{{ accent_color_hover.get('value', '#0056b3') if accent_color_hover else '#0056b3' }}"
                                    class="setting-input color-text-input"
                                    placeholder="#0056b3"
                                    pattern="^#[0-9A-Fa-f]{6}$"
                                >
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-card color-picker-card">
                        <div class="setting-card-header">
                            <label for="setting_accent_color_dark" class="setting-label">
                                –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç (—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞)
                            </label>
                            <span class="setting-badge">–¶–≤–µ—Ç–∞</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã</small>
                            
                            <!-- –ü—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞ -->
                            <div class="color-preview" id="preview_accent_color_dark" style="background-color: {{ accent_color_dark.get('value', '#4a9eff') if accent_color_dark else '#4a9eff' }};">
                                <span class="color-preview-text">{{ accent_color_dark.get('value', '#4a9eff') if accent_color_dark else '#4a9eff' }}</span>
                            </div>
                            
                            <!-- –ü–∞–ª–∏—Ç—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
                            <div class="color-palette">
                                <div class="color-palette-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞:</div>
                                <div class="color-palette-grid" data-target="setting_accent_color_dark">
                                    <div class="color-palette-item" data-color="#4a9eff" style="background-color: #4a9eff;" title="–°–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π"></div>
                                    <div class="color-palette-item" data-color="#66bb6a" style="background-color: #66bb6a;" title="–°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#ef5350" style="background-color: #ef5350;" title="–°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#ffca28" style="background-color: #ffca28;" title="–°–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π"></div>
                                    <div class="color-palette-item" data-color="#26c6da" style="background-color: #26c6da;" title="–°–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π"></div>
                                    <div class="color-palette-item" data-color="#ab47bc" style="background-color: #ab47bc;" title="–°–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#ec407a" style="background-color: #ec407a;" title="–°–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#ff9800" style="background-color: #ff9800;" title="–°–≤–µ—Ç–ª–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                                </div>
                            </div>
                            
                            <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                            <div class="color-input-group">
                                <input 
                                    type="color" 
                                    id="setting_accent_color_dark" 
                                    value="{{ accent_color_dark.get('value', '#4a9eff') if accent_color_dark else '#4a9eff' }}"
                                    class="setting-input color-picker-input"
                                >
                                <input 
                                    type="text" 
                                    id="setting_accent_color_dark_text" 
                                    name="setting_accent_color_dark"
                                    value="{{ accent_color_dark.get('value', '#4a9eff') if accent_color_dark else '#4a9eff' }}"
                                    class="setting-input color-text-input"
                                    placeholder="#4a9eff"
                                    pattern="^#[0-9A-Fa-f]{6}$"
                                >
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-card color-picker-card">
                        <div class="setting-card-header">
                            <label for="setting_accent_color_hover_dark" class="setting-label">
                                –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞)
                            </label>
                            <span class="setting-badge">–¶–≤–µ—Ç–∞</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ –∏ —Å—Å—ã–ª–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞)</small>
                            
                            <!-- –ü—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞ -->
                            <div class="color-preview" id="preview_accent_color_hover_dark" style="background-color: {{ accent_color_hover_dark.get('value', '#357abd') if accent_color_hover_dark else '#357abd' }};">
                                <span class="color-preview-text">{{ accent_color_hover_dark.get('value', '#357abd') if accent_color_hover_dark else '#357abd' }}</span>
                            </div>
                            
                            <!-- –ü–∞–ª–∏—Ç—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
                            <div class="color-palette">
                                <div class="color-palette-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞:</div>
                                <div class="color-palette-grid" data-target="setting_accent_color_hover_dark">
                                    <div class="color-palette-item" data-color="#357abd" style="background-color: #357abd;" title="–¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π"></div>
                                    <div class="color-palette-item" data-color="#4caf50" style="background-color: #4caf50;" title="–¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#d32f2f" style="background-color: #d32f2f;" title="–¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#f57c00" style="background-color: #f57c00;" title="–¢–µ–º–Ω–æ-–∂–µ–ª—Ç—ã–π"></div>
                                    <div class="color-palette-item" data-color="#0288d1" style="background-color: #0288d1;" title="–¢–µ–º–Ω–æ-–≥–æ–ª—É–±–æ–π"></div>
                                    <div class="color-palette-item" data-color="#7b1fa2" style="background-color: #7b1fa2;" title="–¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#c2185b" style="background-color: #c2185b;" title="–¢–µ–º–Ω–æ-—Ä–æ–∑–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#e65100" style="background-color: #e65100;" title="–¢–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                                </div>
                            </div>
                            
                            <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                            <div class="color-input-group">
                                <input 
                                    type="color" 
                                    id="setting_accent_color_hover_dark" 
                                    value="{{ accent_color_hover_dark.get('value', '#357abd') if accent_color_hover_dark else '#357abd' }}"
                                    class="setting-input color-picker-input"
                                >
                                <input 
                                    type="text" 
                                    id="setting_accent_color_hover_dark_text" 
                                    name="setting_accent_color_hover_dark"
                                    value="{{ accent_color_hover_dark.get('value', '#357abd') if accent_color_hover_dark else '#357abd' }}"
                                    class="setting-input color-text-input"
                                    placeholder="#357abd"
                                    pattern="^#[0-9A-Fa-f]{6}$"
                                >
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info" style="margin-top: 2rem;">
                    <strong>üí° –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                        <li><strong>–ö–ª–∏–∫ –ø–æ —Ü–≤–µ—Ç—É –≤ –ø–∞–ª–∏—Ç—Ä–µ</strong> - –±—ã—Å—Ç—Ä–æ –≤—ã–±—Ä–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ü–≤–µ—Ç</li>
                        <li><strong>Color picker</strong> - –≤—ã–±—Ä–∞—Ç—å –ª—é–±–æ–π —Ü–≤–µ—Ç –∏–∑ –ø–æ–ª–Ω–æ–π –ø–∞–ª–∏—Ç—Ä—ã</li>
                        <li><strong>–í–≤–æ–¥ hex-–∫–æ–¥–∞</strong> - –≤–≤–µ—Å—Ç–∏ —Ç–æ—á–Ω—ã–π —Ü–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ #RRGGBB</li>
                    </ul>
                    <p style="margin: 0.5rem 0 0 0;">–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã. –¶–≤–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∫–Ω–æ–ø–æ–∫, —Å—Å—ã–ª–æ–∫, –∞–∫—Ü–µ–Ω—Ç–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.</p>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ -->
        <div class="settings-tab-content" data-tab="localization">
            <div class="settings-section">
                <h2 class="settings-section-title">üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
                
                {% if not BABEL_AVAILABLE %}
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> Flask-Babel –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –î–ª—è —Ä–∞–±–æ—Ç—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: <code>pip install -r requirements.txt</code>
                </div>
                {% endif %}
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label for="default_language" class="setting-label">
                                –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                            </label>
                            <span class="setting-badge">–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                            <select 
                                id="default_language" 
                                name="default_language" 
                                class="setting-input"
                            >
                                {% for lang_code, lang_name in available_languages.items() %}
                                <option value="{{ lang_code }}" {% if default_language == lang_code %}selected{% endif %}>
                                    {{ lang_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label class="setting-label">–¢–µ–∫—É—â–∞—è –ª–æ–∫–∞–ª—å</label>
                            <span class="setting-badge">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                        </div>
                        <div class="setting-card-body">
                            <p><strong>–ê–∫—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫:</strong> 
                                <span class="badge">{{ available_languages.get(current_locale, current_locale) }}</span>
                                <code>({{ current_locale }})</code>
                            </p>
                            <small class="setting-hint">
                                –¢–µ–∫—É—â–∏–π —è–∑—ã–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:<br>
                                1. –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)<br>
                                2. –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã—à–µ)<br>
                                3. –†—É—Å—Å–∫–∏–π (—Å–∏—Å—Ç–µ–º–Ω—ã–π)
                            </small>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label class="setting-label">–î–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫–∏</label>
                            <span class="setting-badge">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                        </div>
                        <div class="setting-card-body">
                            <ul class="language-list">
                                {% for lang_code, lang_name in available_languages.items() %}
                                <li>
                                    <strong>{{ lang_name }}</strong>
                                    <code>{{ lang_code }}</code>
                                    {% if lang_code == current_locale %}
                                    <span class="badge badge-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                            <small class="setting-hint">
                                –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —è–∑—ã–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ <code>app.py</code> –∏ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <div class="settings-tab-content" data-tab="modals">
            <div class="settings-section">
                <h2 class="settings-section-title">üí¨ –¢–µ–∫—Å—Ç—ã –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>
                <p class="setting-hint" style="margin-bottom: 2rem;">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–µ–∫—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è.</p>
                
                {% set modals_settings = settings_by_category.get('modals', []) %}
                {% if modals_settings %}
                <div class="settings-grid">
                    {% for setting in modals_settings %}
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label for="setting_{{ setting.key }}" class="setting-label">
                                {{ setting.description or setting.key }}
                            </label>
                        </div>
                        <div class="setting-card-body">
                            <textarea 
                                id="setting_{{ setting.key }}"
                                name="setting_{{ setting.key }}"
                                class="setting-input"
                                rows="3"
                                placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."
                            >{{ setting.value or '' }}</textarea>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alert alert-info">
                    <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π URL hash
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.settings-tab');
    const tabContents = document.querySelectorAll('.settings-tab-content');
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–∞
    function switchTab(tabName) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ç–∞–±—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
        const selectedTab = document.querySelector(`.settings-tab[data-tab="${tabName}"]`);
        const selectedContent = document.querySelector(`.settings-tab-content[data-tab="${tabName}"]`);
        
        if (selectedTab && selectedContent) {
            selectedTab.classList.add('active');
            selectedContent.classList.add('active');
            // –û–±–Ω–æ–≤–ª—è–µ–º URL hash –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (window.location.hash !== '#' + tabName) {
                window.history.replaceState(null, '', '#' + tabName);
            }
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç–∞–±–∞–º
    tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const targetTab = this.getAttribute('data-tab');
            switchTab(targetTab);
        });
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º hash –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const hash = window.location.hash.substring(1); // –£–±–∏—Ä–∞–µ–º #
    if (hash) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–± —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º
        const tabExists = Array.from(tabs).some(t => t.getAttribute('data-tab') === hash);
        if (tabExists) {
            switchTab(hash);
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è hash (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–Ω–æ–ø–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞)
    window.addEventListener('hashchange', function() {
        const newHash = window.location.hash.substring(1);
        if (newHash) {
            const tabExists = Array.from(tabs).some(t => t.getAttribute('data-tab') === newHash);
            if (tabExists) {
                switchTab(newHash);
            }
        }
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ç–∞–±–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
    const integrationSubtabs = document.querySelectorAll('.integration-subtab');
    const integrationContents = document.querySelectorAll('.integration-content');
    
    integrationSubtabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const integration = this.getAttribute('data-integration');
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –ø–æ–¥—Ç–∞–±–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            integrationSubtabs.forEach(t => t.classList.remove('active'));
            integrationContents.forEach(c => c.classList.remove('active'));
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø–æ–¥—Ç–∞–±—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
            this.classList.add('active');
            const content = document.querySelector(`.integration-content[data-integration="${integration}"]`);
            if (content) {
                content.classList.add('active');
            }
        });
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Dadata API
    const verifyDadataBtn = document.getElementById('verify-dadata-btn');
    const verifyStatus = document.getElementById('dadata-verify-status');
    const dadataEnabledCheckbox = document.getElementById('dadata_enabled');
    
    if (verifyDadataBtn) {
        verifyDadataBtn.addEventListener('click', function() {
            const apiKey = document.getElementById('dadata_api_key').value.trim();
            const secretKey = document.getElementById('dadata_secret_key').value.trim();
            
            if (!apiKey || !secretKey) {
                verifyStatus.textContent = '‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è';
                verifyStatus.className = 'verify-status error';
                return;
            }
            
            verifyDadataBtn.disabled = true;
            verifyDadataBtn.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            verifyStatus.textContent = '';
            verifyStatus.className = 'verify-status';
            
            const formData = new FormData();
            formData.append('api_key', apiKey);
            formData.append('secret_key', secretKey);
            
            fetch('{{ url_for("verify_dadata") }}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    verifyStatus.textContent = '‚úÖ ' + data.message;
                    verifyStatus.className = 'verify-status success';
                    if (dadataEnabledCheckbox) {
                        dadataEnabledCheckbox.disabled = false;
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        const hint = dadataEnabledCheckbox.closest('.setting-item').querySelector('.setting-hint');
                        if (hint) {
                            hint.textContent = '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞';
                        }
                    }
                } else {
                    verifyStatus.textContent = '‚ùå ' + data.message;
                    verifyStatus.className = 'verify-status error';
                    if (dadataEnabledCheckbox) {
                        dadataEnabledCheckbox.disabled = true;
                        dadataEnabledCheckbox.checked = false;
                        const hiddenInput = document.getElementById('dadata_enabled_hidden');
                        if (hiddenInput) {
                            hiddenInput.value = '0';
                        }
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        const hint = dadataEnabledCheckbox.closest('.setting-item').querySelector('.setting-hint');
                        if (hint) {
                            hint.textContent = '–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏';
                        }
                    }
                }
            })
            .catch(error => {
                verifyStatus.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ' + error.message;
                verifyStatus.className = 'verify-status error';
            })
            .finally(() => {
                verifyDadataBtn.disabled = false;
                verifyDadataBtn.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏';
            });
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ SMTP
    const verifySmtpBtn = document.getElementById('verify-smtp-btn');
    const smtpVerifyStatus = document.getElementById('smtp-verify-status');
    const smtpEnabledCheckbox = document.getElementById('smtp_enabled');
    
    if (verifySmtpBtn) {
        verifySmtpBtn.addEventListener('click', function() {
            const host = document.getElementById('smtp_host').value.trim();
            const port = document.getElementById('smtp_port').value.trim();
            const username = document.getElementById('smtp_username').value.trim();
            const password = document.getElementById('smtp_password').value.trim();
            const useTls = document.getElementById('smtp_use_tls').checked;
            const fromEmail = document.getElementById('smtp_from_email').value.trim();
            
            if (!host || !port || !username || !password || !fromEmail) {
                smtpVerifyStatus.textContent = '‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è';
                smtpVerifyStatus.className = 'verify-status error';
                return;
            }
            
            verifySmtpBtn.disabled = true;
            verifySmtpBtn.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            smtpVerifyStatus.textContent = '';
            smtpVerifyStatus.className = 'verify-status';
            
            const formData = new FormData();
            formData.append('host', host);
            formData.append('port', port);
            formData.append('username', username);
            formData.append('password', password);
            formData.append('use_tls', useTls ? '1' : '0');
            formData.append('from_email', fromEmail);
            
            const verifySmtpUrl = {{ url_for("verify_smtp")|tojson }};
            fetch(verifySmtpUrl, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    smtpVerifyStatus.textContent = '‚úÖ ' + data.message;
                    smtpVerifyStatus.className = 'verify-status success';
                    if (smtpEnabledCheckbox) {
                        smtpEnabledCheckbox.disabled = false;
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        const hint = smtpEnabledCheckbox.closest('.setting-item').querySelector('.setting-hint');
                        if (hint) {
                            hint.textContent = 'SMTP –∞–∫—Ç–∏–≤–µ–Ω';
                        }
                    }
                } else {
                    smtpVerifyStatus.textContent = '‚ùå ' + data.message;
                    smtpVerifyStatus.className = 'verify-status error';
                    if (smtpEnabledCheckbox) {
                        smtpEnabledCheckbox.disabled = true;
                        smtpEnabledCheckbox.checked = false;
                        const hiddenInput = document.getElementById('smtp_enabled_hidden');
                        if (hiddenInput) {
                            hiddenInput.value = '0';
                        }
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        const hint = smtpEnabledCheckbox.closest('.setting-item').querySelector('.setting-hint');
                        if (hint) {
                            hint.textContent = '–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ';
                        }
                    }
                }
            })
            .catch(error => {
                smtpVerifyStatus.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ' + error.message;
                smtpVerifyStatus.className = 'verify-status error';
            })
            .finally(() => {
                verifySmtpBtn.disabled = false;
                verifySmtpBtn.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ';
            });
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Telegram –±–æ—Ç–∞
    const verifyTelegramBtn = document.getElementById('verify-telegram-btn');
    const telegramVerifyStatus = document.getElementById('telegram-verify-status');
    const telegramEnabledCheckbox = document.getElementById('telegram_enabled');
    
    if (verifyTelegramBtn) {
        verifyTelegramBtn.addEventListener('click', function() {
            const token = document.getElementById('telegram_bot_token').value.trim();
            const chatId = document.getElementById('telegram_chat_id').value.trim();
            
            if (!token) {
                telegramVerifyStatus.textContent = '‚ùå –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω';
                telegramVerifyStatus.className = 'verify-status error';
                return;
            }
            
            verifyTelegramBtn.disabled = true;
            verifyTelegramBtn.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            telegramVerifyStatus.textContent = '';
            telegramVerifyStatus.className = 'verify-status';
            
            const formData = new FormData();
            formData.append('token', token);
            if (chatId) {
                formData.append('chat_id', chatId);
            }
            
            const verifyTelegramUrl = {{ url_for("verify_telegram")|tojson }};
            fetch(verifyTelegramUrl, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    telegramVerifyStatus.textContent = '‚úÖ ' + data.message;
                    telegramVerifyStatus.className = 'verify-status success';
                    if (telegramEnabledCheckbox) {
                        telegramEnabledCheckbox.disabled = false;
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        const hint = telegramEnabledCheckbox.closest('.setting-item').querySelector('.setting-hint');
                        if (hint) {
                            hint.textContent = 'Telegram –±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω';
                        }
                    }
                } else {
                    telegramVerifyStatus.textContent = '‚ùå ' + data.message;
                    telegramVerifyStatus.className = 'verify-status error';
                    if (telegramEnabledCheckbox) {
                        telegramEnabledCheckbox.disabled = true;
                        telegramEnabledCheckbox.checked = false;
                        const hiddenInput = document.getElementById('telegram_enabled_hidden');
                        if (hiddenInput) {
                            hiddenInput.value = '0';
                        }
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        const hint = telegramEnabledCheckbox.closest('.setting-item').querySelector('.setting-hint');
                        if (hint) {
                            hint.textContent = '–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ';
                        }
                    }
                }
            })
            .catch(error => {
                telegramVerifyStatus.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ' + error.message;
                telegramVerifyStatus.className = 'verify-status error';
            })
            .finally(() => {
                verifyTelegramBtn.disabled = false;
                verifyTelegramBtn.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ';
            });
        });
    }
    });
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è color picker –∏ text input –¥–ª—è —Ü–≤–µ—Ç–æ–≤
    const colorInputs = [
        { color: 'setting_accent_color', text: 'setting_accent_color_text', preview: 'preview_accent_color' },
        { color: 'setting_accent_color_hover', text: 'setting_accent_color_hover_text', preview: 'preview_accent_color_hover' },
        { color: 'setting_accent_color_dark', text: 'setting_accent_color_dark_text', preview: 'preview_accent_color_dark' },
        { color: 'setting_accent_color_hover_dark', text: 'setting_accent_color_hover_dark_text', preview: 'preview_accent_color_hover_dark' }
    ];
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞
    function updateColorPreview(colorValue, previewId) {
        const preview = document.getElementById(previewId);
        if (preview) {
            preview.style.backgroundColor = colorValue;
            const text = preview.querySelector('.color-preview-text');
            if (text) {
                text.textContent = colorValue;
            }
        }
    }
    
    colorInputs.forEach(function(pair) {
        const colorInput = document.getElementById(pair.color);
        const textInput = document.getElementById(pair.text);
        
        if (colorInput && textInput) {
            // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ color picker –æ–±–Ω–æ–≤–ª—è–µ–º text input –∏ –ø—Ä–µ–≤—å—é
            colorInput.addEventListener('input', function() {
                const value = colorInput.value;
                textInput.value = value;
                updateColorPreview(value, pair.preview);
            });
            
            // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ text input –æ–±–Ω–æ–≤–ª—è–µ–º color picker –∏ –ø—Ä–µ–≤—å—é
            textInput.addEventListener('input', function() {
                const value = textInput.value.trim();
                if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
                    colorInput.value = value;
                    updateColorPreview(value, pair.preview);
                }
            });
        }
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞ –≤ –ø–∞–ª–∏—Ç—Ä–µ
    function highlightCurrentColor(palette, currentColor) {
        palette.querySelectorAll('.color-palette-item').forEach(function(item) {
            const itemColor = item.getAttribute('data-color');
            item.classList.remove('selected');
            if (itemColor && itemColor.toLowerCase() === currentColor.toLowerCase()) {
                item.classList.add('selected');
            }
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –ø–∞–ª–∏—Ç—Ä–µ —Ü–≤–µ—Ç–æ–≤
    document.querySelectorAll('.color-palette-grid').forEach(function(palette) {
        const targetId = palette.getAttribute('data-target');
        const colorInput = document.getElementById(targetId);
        const textInput = document.getElementById(targetId + '_text');
        const previewId = 'preview_' + targetId;
        
        if (colorInput && textInput) {
            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ü–≤–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const currentColor = colorInput.value;
            highlightCurrentColor(palette, currentColor);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ü–≤–µ—Ç–∞–º –≤ –ø–∞–ª–∏—Ç—Ä–µ
            palette.querySelectorAll('.color-palette-item').forEach(function(item) {
                item.addEventListener('click', function() {
                    const color = this.getAttribute('data-color');
                    if (color) {
                        colorInput.value = color;
                        textInput.value = color;
                        updateColorPreview(color, previewId);
                        
                        // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
                        highlightCurrentColor(palette, color);
                    }
                });
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ color picker –∏–ª–∏ text input
            colorInput.addEventListener('input', function() {
                highlightCurrentColor(palette, colorInput.value);
            });
            
            textInput.addEventListener('input', function() {
                const value = textInput.value.trim();
                if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
                    highlightCurrentColor(palette, value);
                }
            });
        }
    });
</script>

<style>
.language-list {
    list-style: none;
    padding: 0;
    margin: 1rem 0;
}

.language-list li {
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background: var(--bg-secondary);
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.language-list li strong {
    min-width: 120px;
}

.language-list li code {
    background: var(--bg-primary);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
}

.badge-active {
    background-color: #28a745;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.875rem;
    margin-left: auto;
}

.alert {
    padding: 1rem;
    margin-bottom: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid;
}

.alert-warning {
    background-color: #fff3cd;
    border-color: #ffc107;
    color: #856404;
}

.alert code {
    background-color: rgba(0, 0, 0, 0.1);
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–Ω—é –±–æ—Ç–∞ */
.bot-menu-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.bot-menu-item {
    padding: 1rem;
    background: var(--bg-card, #fff);
    border: 1px solid var(--border-color, #e0e0e0);
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.bot-menu-item-info {
    flex: 1;
}

.bot-menu-item-text {
    font-weight: 600;
    color: var(--text-primary, #333);
    margin-bottom: 0.25rem;
}

.bot-menu-item-details {
    font-size: 0.85em;
    color: var(--text-secondary, #666);
}

.bot-menu-item-actions {
    display: flex;
    gap: 0.5rem;
}

.menu-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.menu-modal.active {
    display: flex;
}

.menu-modal-content {
    background: var(--bg-card, #fff);
    border-radius: 8px;
    padding: 2rem;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}
</style>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—É–Ω–∫—Ç–æ–º –º–µ–Ω—é -->
<div id="menu-modal" class="menu-modal">
    <div class="menu-modal-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 id="menu-modal-title">–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é</h2>
            <button type="button" onclick="closeMenuModal()" style="background: none; border: none; font-size: 1.5em; cursor: pointer;">&times;</button>
        </div>
        
        <form id="menu-form" method="POST" action="{{ url_for('admin_telegram_menu') }}">
            <input type="hidden" name="action" id="menu-action" value="create">
            <input type="hidden" name="menu_id" id="menu-id">
            
            <div class="setting-item" style="margin-bottom: 1rem;">
                <label for="menu-button-text" class="setting-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ *</label>
                <input type="text" id="menu-button-text" name="button_text" class="setting-input" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è">
            </div>
            
            <div class="setting-item" style="margin-bottom: 1rem;">
                <label for="menu-button-type" class="setting-label">–¢–∏–ø –∫–Ω–æ–ø–∫–∏ *</label>
                <select id="menu-button-type" name="button_type" class="setting-input" required onchange="updateMenuActionPlaceholder()">
                    <option value="command">–ö–æ–º–∞–Ω–¥–∞ (command)</option>
                    <option value="url">–°—Å—ã–ª–∫–∞ (url)</option>
                    <option value="callback">Callback (callback)</option>
                </select>
            </div>
            
            <div class="setting-item" style="margin-bottom: 1rem;">
                <label for="menu-action-value" class="setting-label">–î–µ–π—Å—Ç–≤–∏–µ *</label>
                <input type="text" id="menu-action-value" name="action_value" class="setting-input" required placeholder="events">
                <small class="setting-hint" id="menu-action-hint">
                    –î–ª—è –∫–æ–º–∞–Ω–¥—ã: –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: events, assignments)<br>
                    –î–ª—è —Å—Å—ã–ª–∫–∏: URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: /faq, /rules –∏–ª–∏ –ø–æ–ª–Ω—ã–π URL)<br>
                    –î–ª—è callback: callback_data
                </small>
            </div>
            
            <div class="setting-item" style="margin-bottom: 1rem;">
                <label for="menu-sort-order" class="setting-label">–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</label>
                <input type="number" id="menu-sort-order" name="sort_order" class="setting-input" value="100" min="0">
                <small class="setting-hint">–ú–µ–Ω—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ = –≤—ã—à–µ –≤ –º–µ–Ω—é</small>
            </div>
            
            <div class="setting-item" style="margin-bottom: 1.5rem;">
                <label for="menu-is-active" class="setting-label">
                    <input type="checkbox" id="menu-is-active" name="is_active" value="1" checked class="setting-checkbox">
                    <span>–ê–∫—Ç–∏–≤–µ–Ω</span>
                </label>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" onclick="closeMenuModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<script>
// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –±–æ—Ç–∞
let botMenuItems = {{ bot_menu_items|tojson|safe }};

function loadBotMenu() {
    const container = document.getElementById('bot-menu-list');
    if (!container) {
        console.log('bot-menu-list container not found');
        return;
    }
    
    console.log('Loading bot menu, items count:', botMenuItems ? botMenuItems.length : 0);
    
    if (botMenuItems.length === 0) {
        container.innerHTML = '<p style="color: var(--text-secondary, #666);">–ü—É–Ω–∫—Ç—ã –º–µ–Ω—é –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
        return;
    }
    
    container.innerHTML = botMenuItems.map(item => {
        const typeLabels = {
            'command': '–ö–æ–º–∞–Ω–¥–∞',
            'url': '–°—Å—ã–ª–∫–∞',
            'callback': 'Callback'
        };
        const statusBadge = item.is_active 
            ? '<span style="background: var(--success-color, #28a745); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8em;">–ê–∫—Ç–∏–≤–µ–Ω</span>'
            : '<span style="background: var(--error-color, #dc3545); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8em;">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>';
        
        return `
            <div class="bot-menu-item">
                <div class="bot-menu-item-info">
                    <div class="bot-menu-item-text">${item.button_text}</div>
                    <div class="bot-menu-item-details">
                        –¢–∏–ø: ${typeLabels[item.button_type] || item.button_type} | 
                        –î–µ–π—Å—Ç–≤–∏–µ: ${item.action} | 
                        –ü–æ—Ä—è–¥–æ–∫: ${item.sort_order}
                    </div>
                </div>
                <div class="bot-menu-item-actions">
                    ${statusBadge}
                    <button type="button" class="btn btn-secondary" onclick="editMenuItem(${item.id})" style="padding: 0.5rem 1rem;">‚úèÔ∏è</button>
                    <form method="POST" action="{{ url_for('admin_telegram_menu') }}" style="display: inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç –º–µ–Ω—é?');">
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="menu_id" value="${item.id}">
                        <button type="submit" class="btn btn-secondary" style="padding: 0.5rem 1rem;">üóëÔ∏è</button>
                    </form>
                </div>
            </div>
        `;
    }).join('');
}

function showMenuModal(action, menuId = null) {
    const modal = document.getElementById('menu-modal');
    const form = document.getElementById('menu-form');
    const title = document.getElementById('menu-modal-title');
    const actionInput = document.getElementById('menu-action');
    const idInput = document.getElementById('menu-id');
    
    if (action === 'create') {
        title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é';
        actionInput.value = 'create';
        idInput.value = '';
        form.reset();
        document.getElementById('menu-sort-order').value = '100';
        document.getElementById('menu-is-active').checked = true;
    } else if (action === 'edit' && menuId) {
        title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é';
        actionInput.value = 'update';
        idInput.value = menuId;
        
        const item = botMenuItems.find(m => m.id === menuId);
        if (item) {
            document.getElementById('menu-button-text').value = item.button_text;
            document.getElementById('menu-button-type').value = item.button_type;
            document.getElementById('menu-action-value').value = item.action;
            document.getElementById('menu-sort-order').value = item.sort_order;
            document.getElementById('menu-is-active').checked = item.is_active == 1;
            updateMenuActionPlaceholder();
        }
    }
    
    modal.classList.add('active');
}

function closeMenuModal() {
    document.getElementById('menu-modal').classList.remove('active');
}

function editMenuItem(menuId) {
    showMenuModal('edit', menuId);
}

function updateMenuActionPlaceholder() {
    const type = document.getElementById('menu-button-type').value;
    const actionInput = document.getElementById('menu-action-value');
    const hint = document.getElementById('menu-action-hint');
    
    if (type === 'command') {
        actionInput.placeholder = 'events';
        hint.innerHTML = '–î–ª—è –∫–æ–º–∞–Ω–¥—ã: –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: events, assignments)';
    } else if (type === 'url') {
        actionInput.placeholder = '/faq';
        hint.innerHTML = '–î–ª—è —Å—Å—ã–ª–∫–∏: URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: /faq, /rules –∏–ª–∏ –ø–æ–ª–Ω—ã–π URL)';
    } else if (type === 'callback') {
        actionInput.placeholder = 'callback_data';
        hint.innerHTML = '–î–ª—è callback: callback_data';
    }
}

function copyWebhookUrl() {
    const url = document.getElementById('webhook-url').textContent;
    navigator.clipboard.writeText(url).then(() => {
        alert('URL –≤–µ–±—Ö—É–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    }).catch(() => {
        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        const textarea = document.createElement('textarea');
        textarea.value = url;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('URL –≤–µ–±—Ö—É–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    });
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–Ω—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Telegram
document.addEventListener('DOMContentLoaded', function() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–Ω—é —Å—Ä–∞–∑—É
    loadBotMenu();
    
    // –¢–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Telegram
    const telegramSubtab = document.querySelector('.integration-subtab[data-integration="telegram"]');
    const integrationSubtabs = document.querySelectorAll('.integration-subtab');
    const integrationContents = document.querySelectorAll('.integration-content');
    
    if (integrationSubtabs.length > 0) {
        integrationSubtabs.forEach(subtab => {
            subtab.addEventListener('click', function() {
                const integration = this.dataset.integration;
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ç–∞–±—ã
                integrationSubtabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                integrationContents.forEach(content => {
                    if (content.dataset.integration === integration) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
                
                // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ Telegram, –∑–∞–≥—Ä—É–∂–∞–µ–º –º–µ–Ω—é
                if (integration === 'telegram') {
                    setTimeout(() => {
                        loadBotMenu();
                    }, 100);
                }
            });
        });
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ–Ω—é –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å)
    const menuForm = document.getElementById('menu-form');
    if (menuForm) {
        menuForm.addEventListener('submit', function(e) {
            // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            setTimeout(() => {
                location.reload();
            }, 500);
        });
    }
});
</script>
{% endblock %}

