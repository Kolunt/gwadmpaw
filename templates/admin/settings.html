{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h1>
        <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <form method="POST" class="settings-form" enctype="multipart/form-data">
        <!-- –¢–∞–±—ã -->
        <div class="settings-tabs">
            {% for category, settings in settings_by_category.items() %}
            <a 
                href="{{ url_for('admin_settings') }}#{{ category }}"
                class="settings-tab {% if loop.first %}active{% endif %}"
                data-tab="{{ category }}"
            >
                {% if category == 'gwars' %}
                    ‚öîÔ∏è GWars
                {% elif category == 'system' %}
                    üîß –ë–ª–∞—Ç–Ω—ã–µ
                {% elif category == 'integrations' %}
                    üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
                {% elif category == 'design' %}
                    üé® –î–∏–∑–∞–π–Ω
                {% else %}
                    üìã –û–±—â–∏–µ
                {% endif %}
            </a>
            {% endfor %}
            <a 
                href="{{ url_for('admin_settings') }}#design"
                class="settings-tab"
                data-tab="design"
            >
                üé® –î–∏–∑–∞–π–Ω
            </a>
            <a 
                href="{{ url_for('admin_settings') }}#localization"
                class="settings-tab"
                data-tab="localization"
            >
                üåê –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
            </a>
        </div>
        
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤ -->
        {% for category, settings in settings_by_category.items() %}
        <div class="settings-tab-content {% if loop.first %}active{% endif %}" data-tab="{{ category }}">
            {% if category == 'integrations' %}
            <!-- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π -->
            <div class="integrations-container">
                <!-- –ü–æ–¥—Ç–∞–±—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π -->
                <div class="integrations-subtabs">
                    <button type="button" class="integration-subtab active" data-integration="dadata">
                        üîç Dadata
                    </button>
                </div>
                
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–¥—Ç–∞–±–æ–≤ -->
                <div class="integration-content active" data-integration="dadata">
                    <div class="settings-section">
                        <h2 class="settings-section-title">üîç –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Dadata</h2>
                        
                        {% set dadata_api_key = settings_dict.get('dadata_api_key', {}) %}
                        {% set dadata_secret_key = settings_dict.get('dadata_secret_key', {}) %}
                        {% set dadata_enabled = settings_dict.get('dadata_enabled', {}) %}
                        {% set dadata_verified = settings_dict.get('dadata_verified', {}) %}
                        
                        <div class="dadata-integration-form">
                            <div class="setting-item">
                                <label for="dadata_api_key" class="setting-label">
                                    API –∫–ª—é—á
                                    <small class="setting-hint">API –∫–ª—é—á –æ—Ç Dadata</small>
                                </label>
                                <input 
                                    type="text" 
                                    id="dadata_api_key" 
                                    name="setting_dadata_api_key" 
                                    value="{{ dadata_api_key.get('value', '') if dadata_api_key else '' }}"
                                    class="setting-input"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <label for="dadata_secret_key" class="setting-label">
                                    Secret –∫–ª—é—á
                                    <small class="setting-hint">Secret –∫–ª—é—á –æ—Ç Dadata</small>
                                </label>
                                <input 
                                    type="password" 
                                    id="dadata_secret_key" 
                                    name="setting_dadata_secret_key" 
                                    value="{{ dadata_secret_key.get('value', '') if dadata_secret_key else '' }}"
                                    class="setting-input"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ Secret –∫–ª—é—á"
                                >
                            </div>
                            
                            <div class="setting-item">
                                <button type="button" id="verify-dadata-btn" class="btn btn-secondary">
                                    üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏
                                </button>
                                <span id="dadata-verify-status" class="verify-status"></span>
                            </div>
                            
                            <div class="setting-item">
                                <label for="dadata_enabled" class="setting-label">
                                    <input 
                                        type="checkbox" 
                                        id="dadata_enabled" 
                                        name="setting_dadata_enabled" 
                                        value="1"
                                        {% if dadata_enabled and dadata_enabled.get('value', '0') == '1' %}checked{% endif %}
                                        {% if not dadata_verified or dadata_verified.get('value', '0') != '1' %}disabled{% endif %}
                                        class="setting-checkbox"
                                        onchange="document.getElementById('dadata_enabled_hidden').value = this.checked ? '1' : '0';"
                                    >
                                    <input type="hidden" id="dadata_enabled_hidden" name="setting_dadata_enabled" value="{% if dadata_enabled and dadata_enabled.get('value', '0') == '1' %}1{% else %}0{% endif %}">
                                    <span>–í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Dadata</span>
                                    <small class="setting-hint">
                                        {% if not dadata_verified or dadata_verified.get('value', '0') != '1' %}
                                            –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏
                                        {% else %}
                                            –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞
                                        {% endif %}
                                    </small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% elif category == 'system' %}
            <!-- –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–ë–ª–∞—Ç–Ω—ã–µ) -->
            <div class="settings-section">
                <h2 class="settings-section-title">üîß –ë–ª–∞—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                
                <!-- –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
                <div class="setting-card" style="margin-bottom: 2rem;">
                    <div class="setting-card-header">
                        <label class="setting-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–∏—Å—Ç–µ–º—ã</label>
                        <span class="setting-badge">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    </div>
                    <div class="setting-card-body">
                        <small class="setting-hint">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</small>
                        
                        {% if admin_users %}
                        <div class="admin-users-list" style="margin-top: 1rem;">
                            {% for admin_id in admin_users %}
                            <div class="admin-user-item" style="display: flex; align-items: center; padding: 0.75rem; margin-bottom: 0.5rem; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <div class="admin-user-id" style="font-weight: 600; font-size: 1.1rem; color: var(--accent-color); font-family: 'Courier New', monospace;">
                                    {{ admin_id }}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p style="color: var(--text-secondary); margin-top: 1rem;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π -->
                <div class="setting-card" style="margin-bottom: 2rem;">
                    <div class="setting-card-header">
                        <label class="setting-label">–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–æ–ª–∏</label>
                        <span class="setting-badge">–†–æ–ª–∏</span>
                    </div>
                    <div class="setting-card-body">
                        <small class="setting-hint">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–æ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</small>
                        
                        {% if system_roles %}
                        <div class="system-items-list" style="margin-top: 1rem;">
                            {% for role in system_roles %}
                            <div class="system-item" style="display: flex; align-items: center; padding: 0.75rem; margin-bottom: 0.5rem; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <div style="font-weight: 600; font-size: 1.1rem; color: var(--accent-color); font-family: 'Courier New', monospace; margin-right: 0.5rem;">
                                    {{ role.name }}
                                </div>
                                <div style="color: var(--text-primary);">
                                    {{ role.display_name }}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p style="color: var(--text-secondary); margin-top: 1rem;">–†–æ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–≤–∞–Ω–∏–π -->
                <div class="setting-card" style="margin-bottom: 2rem;">
                    <div class="setting-card-header">
                        <label class="setting-label">–°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–≤–∞–Ω–∏—è</label>
                        <span class="setting-badge">–ó–≤–∞–Ω–∏—è</span>
                    </div>
                    <div class="setting-card-body">
                        <small class="setting-hint">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–≤–∞–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</small>
                        
                        {% if system_titles %}
                        <div class="system-items-list" style="margin-top: 1rem;">
                            {% for title in system_titles %}
                            <div class="system-item" style="display: flex; align-items: center; padding: 0.75rem; margin-bottom: 0.5rem; background-color: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <div style="font-size: 1.2rem; margin-right: 0.75rem;">
                                    {{ title.icon or 'üèÜ' }}
                                </div>
                                <div style="font-weight: 600; font-size: 1.1rem; color: var(--accent-color); font-family: 'Courier New', monospace; margin-right: 0.5rem;">
                                    {{ title.name }}
                                </div>
                                <div style="color: var(--text-primary);">
                                    {{ title.display_name }}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p style="color: var(--text-secondary); margin-top: 1rem;">–ó–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                <div class="settings-grid">
                    {% for setting in settings %}
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label for="setting_{{ setting.key }}" class="setting-label">
                                {{ setting.description or setting.key }}
                            </label>
                            {% if setting.key == 'admin_user_ids' %}
                                <span class="setting-badge">–°–∏—Å—Ç–µ–º–∞</span>
                            {% elif setting.key in ['gwars_site_id', 'gwars_host'] %}
                                <span class="setting-badge">GWars</span>
                            {% elif setting.key in ['default_theme', 'site_icon', 'site_logo', 'site_title', 'site_description', 'logo_text'] %}
                                <span class="setting-badge">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</span>
                            {% endif %}
                        </div>
                        <div class="setting-card-body">
                            {% if setting.key == 'admin_user_ids' %}
                                <small class="setting-hint">ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä: 283494, 240139)</small>
                            {% elif setting.key == 'gwars_site_id' %}
                                <small class="setting-hint">–ß–∏—Å–ª–æ–≤–æ–π ID —Å–∞–π—Ç–∞ –≤ GWars</small>
                            {% elif setting.key == 'gwars_host' %}
                                <small class="setting-hint">–î–æ–º–µ–Ω –±–µ–∑ http:// (–Ω–∞–ø—Ä–∏–º–µ—Ä: gwadm.pythonanywhere.com)</small>
                            {% elif setting.key == 'default_theme' %}
                                <small class="setting-hint">–¢–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                            {% elif setting.key == 'site_icon' %}
                                <small class="setting-hint">–ò–∫–æ–Ω–∫–∞ —Å–∞–π—Ç–∞ (favicon). –§–æ—Ä–º–∞—Ç—ã: .ico, .png, .jpg, .svg</small>
                            {% elif setting.key == 'site_logo' %}
                                <small class="setting-hint">–õ–æ–≥–æ—Ç–∏–ø —Å–∞–π—Ç–∞. –§–æ—Ä–º–∞—Ç—ã: .png, .jpg, .svg, .gif, .webp</small>
                            {% elif setting.key == 'site_title' %}
                                <small class="setting-hint">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–∞–π—Ç–∞, –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–æ –≤–∫–ª–∞–¥–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞</small>
                            {% elif setting.key == 'site_description' %}
                                <small class="setting-hint">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º</small>
                            {% elif setting.key == 'logo_text' %}
                                <small class="setting-hint">–¢–µ–∫—Å—Ç, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ä—è–¥–æ–º —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –≤ —à–∞–ø–∫–µ —Å–∞–π—Ç–∞</small>
                            {% endif %}
                        {% if setting.key == 'default_theme' %}
                        <select 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            class="setting-input"
                        >
                            <option value="light" {% if setting.value == 'light' %}selected{% endif %}>–°–≤–µ—Ç–ª–∞—è</option>
                            <option value="dark" {% if setting.value == 'dark' %}selected{% endif %}>–¢–µ–º–Ω–∞—è</option>
                        </select>
                        {% elif setting.key == 'site_icon' %}
                        <div class="file-upload-group">
                            {% if setting.value %}
                            <div class="current-file-preview">
                                <img src="{{ setting.value }}" alt="–¢–µ–∫—É—â–∞—è –∏–∫–æ–Ω–∫–∞" class="file-preview-icon">
                                <span class="current-file-label">–¢–µ–∫—É—â–∞—è –∏–∫–æ–Ω–∫–∞</span>
                            </div>
                            {% endif %}
                            <input 
                                type="file" 
                                id="site_icon" 
                                name="site_icon" 
                                accept=".ico,.png,.jpg,.jpeg,.svg"
                                class="file-input"
                            >
                            <label for="site_icon" class="file-upload-label">
                                <span class="file-upload-text">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                <span class="file-upload-btn">üìÅ</span>
                            </label>
                        </div>
                        {% elif setting.key == 'site_logo' %}
                        <div class="file-upload-group">
                            {% if setting.value %}
                            <div class="current-file-preview">
                                <img src="{{ setting.value }}" alt="–¢–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø" class="file-preview-logo">
                                <span class="current-file-label">–¢–µ–∫—É—â–∏–π –ª–æ–≥–æ—Ç–∏–ø</span>
                            </div>
                            {% endif %}
                            <input 
                                type="file" 
                                id="site_logo" 
                                name="site_logo" 
                                accept=".png,.jpg,.jpeg,.svg,.gif,.webp"
                                class="file-input"
                            >
                            <label for="site_logo" class="file-upload-label">
                                <span class="file-upload-text">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</span>
                                <span class="file-upload-btn">üìÅ</span>
                            </label>
                        </div>
                        {% elif setting.key == 'site_description' %}
                        <textarea 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            rows="3"
                            class="setting-input"
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞"
                        >{{ setting.value or '' }}</textarea>
                        {% else %}
                        <input 
                            type="text" 
                            id="setting_{{ setting.key }}" 
                            name="setting_{{ setting.key }}" 
                            value="{{ setting.value or '' }}"
                            class="setting-input"
                            {% if setting.key == 'gwars_site_id' %}pattern="[0-9]+"{% endif %}
                        >
                        {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –¥–∏–∑–∞–π–Ω–∞ -->
        <div class="settings-tab-content" data-tab="design">
            <div class="settings-section">
                <h2 class="settings-section-title">üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–≤–µ—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h2>
                
                {% set accent_color = settings_dict.get('accent_color', {}) %}
                {% set accent_color_hover = settings_dict.get('accent_color_hover', {}) %}
                {% set accent_color_dark = settings_dict.get('accent_color_dark', {}) %}
                {% set accent_color_hover_dark = settings_dict.get('accent_color_hover_dark', {}) %}
                
                <div class="settings-grid">
                    <div class="setting-card color-picker-card">
                        <div class="setting-card-header">
                            <label for="setting_accent_color" class="setting-label">
                                –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç (—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞)
                            </label>
                            <span class="setting-badge">–¶–≤–µ—Ç–∞</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã. –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –∏–∑ –ø–∞–ª–∏—Ç—Ä—ã, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ color picker –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ hex-–∫–æ–¥ –≤—Ä—É—á–Ω—É—é.</small>
                            
                            <!-- –ü—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞ -->
                            <div class="color-preview" id="preview_accent_color" style="background-color: {{ accent_color.get('value', '#007bff') if accent_color else '#007bff' }};">
                                <span class="color-preview-text">{{ accent_color.get('value', '#007bff') if accent_color else '#007bff' }}</span>
                            </div>
                            
                            <!-- –ü–∞–ª–∏—Ç—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
                            <div class="color-palette">
                                <div class="color-palette-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞:</div>
                                <div class="color-palette-grid" data-target="setting_accent_color">
                                    <div class="color-palette-item" data-color="#007bff" style="background-color: #007bff;" title="–°–∏–Ω–∏–π (Blue)"></div>
                                    <div class="color-palette-item" data-color="#28a745" style="background-color: #28a745;" title="–ó–µ–ª–µ–Ω—ã–π (Green)"></div>
                                    <div class="color-palette-item" data-color="#dc3545" style="background-color: #dc3545;" title="–ö—Ä–∞—Å–Ω—ã–π (Red)"></div>
                                    <div class="color-palette-item" data-color="#ffc107" style="background-color: #ffc107;" title="–ñ–µ–ª—Ç—ã–π (Yellow)"></div>
                                    <div class="color-palette-item" data-color="#17a2b8" style="background-color: #17a2b8;" title="–ì–æ–ª—É–±–æ–π (Cyan)"></div>
                                    <div class="color-palette-item" data-color="#6f42c1" style="background-color: #6f42c1;" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π (Purple)"></div>
                                    <div class="color-palette-item" data-color="#e83e8c" style="background-color: #e83e8c;" title="–†–æ–∑–æ–≤—ã–π (Pink)"></div>
                                    <div class="color-palette-item" data-color="#fd7e14" style="background-color: #fd7e14;" title="–û—Ä–∞–Ω–∂–µ–≤—ã–π (Orange)"></div>
                                </div>
                            </div>
                            
                            <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                            <div class="color-input-group">
                                <input 
                                    type="color" 
                                    id="setting_accent_color" 
                                    value="{{ accent_color.get('value', '#007bff') if accent_color else '#007bff' }}"
                                    class="setting-input color-picker-input"
                                >
                                <input 
                                    type="text" 
                                    id="setting_accent_color_text" 
                                    name="setting_accent_color"
                                    value="{{ accent_color.get('value', '#007bff') if accent_color else '#007bff' }}"
                                    class="setting-input color-text-input"
                                    placeholder="#007bff"
                                    pattern="^#[0-9A-Fa-f]{6}$"
                                >
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-card color-picker-card">
                        <div class="setting-card-header">
                            <label for="setting_accent_color_hover" class="setting-label">
                                –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞)
                            </label>
                            <span class="setting-badge">–¶–≤–µ—Ç–∞</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ –∏ —Å—Å—ã–ª–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞)</small>
                            
                            <!-- –ü—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞ -->
                            <div class="color-preview" id="preview_accent_color_hover" style="background-color: {{ accent_color_hover.get('value', '#0056b3') if accent_color_hover else '#0056b3' }};">
                                <span class="color-preview-text">{{ accent_color_hover.get('value', '#0056b3') if accent_color_hover else '#0056b3' }}</span>
                            </div>
                            
                            <!-- –ü–∞–ª–∏—Ç—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
                            <div class="color-palette">
                                <div class="color-palette-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞:</div>
                                <div class="color-palette-grid" data-target="setting_accent_color_hover">
                                    <div class="color-palette-item" data-color="#0056b3" style="background-color: #0056b3;" title="–¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π"></div>
                                    <div class="color-palette-item" data-color="#1e7e34" style="background-color: #1e7e34;" title="–¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#c82333" style="background-color: #c82333;" title="–¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#e0a800" style="background-color: #e0a800;" title="–¢–µ–º–Ω–æ-–∂–µ–ª—Ç—ã–π"></div>
                                    <div class="color-palette-item" data-color="#138496" style="background-color: #138496;" title="–¢–µ–º–Ω–æ-–≥–æ–ª—É–±–æ–π"></div>
                                    <div class="color-palette-item" data-color="#5a32a3" style="background-color: #5a32a3;" title="–¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#c2185b" style="background-color: #c2185b;" title="–¢–µ–º–Ω–æ-—Ä–æ–∑–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#d68910" style="background-color: #d68910;" title="–¢–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                                </div>
                            </div>
                            
                            <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                            <div class="color-input-group">
                                <input 
                                    type="color" 
                                    id="setting_accent_color_hover" 
                                    value="{{ accent_color_hover.get('value', '#0056b3') if accent_color_hover else '#0056b3' }}"
                                    class="setting-input color-picker-input"
                                >
                                <input 
                                    type="text" 
                                    id="setting_accent_color_hover_text" 
                                    name="setting_accent_color_hover"
                                    value="{{ accent_color_hover.get('value', '#0056b3') if accent_color_hover else '#0056b3' }}"
                                    class="setting-input color-text-input"
                                    placeholder="#0056b3"
                                    pattern="^#[0-9A-Fa-f]{6}$"
                                >
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-card color-picker-card">
                        <div class="setting-card-header">
                            <label for="setting_accent_color_dark" class="setting-label">
                                –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç (—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞)
                            </label>
                            <span class="setting-badge">–¶–≤–µ—Ç–∞</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã</small>
                            
                            <!-- –ü—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞ -->
                            <div class="color-preview" id="preview_accent_color_dark" style="background-color: {{ accent_color_dark.get('value', '#4a9eff') if accent_color_dark else '#4a9eff' }};">
                                <span class="color-preview-text">{{ accent_color_dark.get('value', '#4a9eff') if accent_color_dark else '#4a9eff' }}</span>
                            </div>
                            
                            <!-- –ü–∞–ª–∏—Ç—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
                            <div class="color-palette">
                                <div class="color-palette-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞:</div>
                                <div class="color-palette-grid" data-target="setting_accent_color_dark">
                                    <div class="color-palette-item" data-color="#4a9eff" style="background-color: #4a9eff;" title="–°–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π"></div>
                                    <div class="color-palette-item" data-color="#66bb6a" style="background-color: #66bb6a;" title="–°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#ef5350" style="background-color: #ef5350;" title="–°–≤–µ—Ç–ª–æ-–∫—Ä–∞—Å–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#ffca28" style="background-color: #ffca28;" title="–°–≤–µ—Ç–ª–æ-–∂–µ–ª—Ç—ã–π"></div>
                                    <div class="color-palette-item" data-color="#26c6da" style="background-color: #26c6da;" title="–°–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π"></div>
                                    <div class="color-palette-item" data-color="#ab47bc" style="background-color: #ab47bc;" title="–°–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#ec407a" style="background-color: #ec407a;" title="–°–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#ff9800" style="background-color: #ff9800;" title="–°–≤–µ—Ç–ª–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                                </div>
                            </div>
                            
                            <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                            <div class="color-input-group">
                                <input 
                                    type="color" 
                                    id="setting_accent_color_dark" 
                                    value="{{ accent_color_dark.get('value', '#4a9eff') if accent_color_dark else '#4a9eff' }}"
                                    class="setting-input color-picker-input"
                                >
                                <input 
                                    type="text" 
                                    id="setting_accent_color_dark_text" 
                                    name="setting_accent_color_dark"
                                    value="{{ accent_color_dark.get('value', '#4a9eff') if accent_color_dark else '#4a9eff' }}"
                                    class="setting-input color-text-input"
                                    placeholder="#4a9eff"
                                    pattern="^#[0-9A-Fa-f]{6}$"
                                >
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-card color-picker-card">
                        <div class="setting-card-header">
                            <label for="setting_accent_color_hover_dark" class="setting-label">
                                –¶–≤–µ—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞)
                            </label>
                            <span class="setting-badge">–¶–≤–µ—Ç–∞</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ –∏ —Å—Å—ã–ª–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞)</small>
                            
                            <!-- –ü—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞ -->
                            <div class="color-preview" id="preview_accent_color_hover_dark" style="background-color: {{ accent_color_hover_dark.get('value', '#357abd') if accent_color_hover_dark else '#357abd' }};">
                                <span class="color-preview-text">{{ accent_color_hover_dark.get('value', '#357abd') if accent_color_hover_dark else '#357abd' }}</span>
                            </div>
                            
                            <!-- –ü–∞–ª–∏—Ç—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
                            <div class="color-palette">
                                <div class="color-palette-title">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ü–≤–µ—Ç–∞:</div>
                                <div class="color-palette-grid" data-target="setting_accent_color_hover_dark">
                                    <div class="color-palette-item" data-color="#357abd" style="background-color: #357abd;" title="–¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π"></div>
                                    <div class="color-palette-item" data-color="#4caf50" style="background-color: #4caf50;" title="–¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#d32f2f" style="background-color: #d32f2f;" title="–¢–µ–º–Ω–æ-–∫—Ä–∞—Å–Ω—ã–π"></div>
                                    <div class="color-palette-item" data-color="#f57c00" style="background-color: #f57c00;" title="–¢–µ–º–Ω–æ-–∂–µ–ª—Ç—ã–π"></div>
                                    <div class="color-palette-item" data-color="#0288d1" style="background-color: #0288d1;" title="–¢–µ–º–Ω–æ-–≥–æ–ª—É–±–æ–π"></div>
                                    <div class="color-palette-item" data-color="#7b1fa2" style="background-color: #7b1fa2;" title="–¢–µ–º–Ω–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#c2185b" style="background-color: #c2185b;" title="–¢–µ–º–Ω–æ-—Ä–æ–∑–æ–≤—ã–π"></div>
                                    <div class="color-palette-item" data-color="#e65100" style="background-color: #e65100;" title="–¢–µ–º–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                                </div>
                            </div>
                            
                            <!-- –ü–æ–ª—è –≤–≤–æ–¥–∞ -->
                            <div class="color-input-group">
                                <input 
                                    type="color" 
                                    id="setting_accent_color_hover_dark" 
                                    value="{{ accent_color_hover_dark.get('value', '#357abd') if accent_color_hover_dark else '#357abd' }}"
                                    class="setting-input color-picker-input"
                                >
                                <input 
                                    type="text" 
                                    id="setting_accent_color_hover_dark_text" 
                                    name="setting_accent_color_hover_dark"
                                    value="{{ accent_color_hover_dark.get('value', '#357abd') if accent_color_hover_dark else '#357abd' }}"
                                    class="setting-input color-text-input"
                                    placeholder="#357abd"
                                    pattern="^#[0-9A-Fa-f]{6}$"
                                >
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info" style="margin-top: 2rem;">
                    <strong>üí° –ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                        <li><strong>–ö–ª–∏–∫ –ø–æ —Ü–≤–µ—Ç—É –≤ –ø–∞–ª–∏—Ç—Ä–µ</strong> - –±—ã—Å—Ç—Ä–æ –≤—ã–±—Ä–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ü–≤–µ—Ç</li>
                        <li><strong>Color picker</strong> - –≤—ã–±—Ä–∞—Ç—å –ª—é–±–æ–π —Ü–≤–µ—Ç –∏–∑ –ø–æ–ª–Ω–æ–π –ø–∞–ª–∏—Ç—Ä—ã</li>
                        <li><strong>–í–≤–æ–¥ hex-–∫–æ–¥–∞</strong> - –≤–≤–µ—Å—Ç–∏ —Ç–æ—á–Ω—ã–π —Ü–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ #RRGGBB</li>
                    </ul>
                    <p style="margin: 0.5rem 0 0 0;">–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã. –¶–≤–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∫–Ω–æ–ø–æ–∫, —Å—Å—ã–ª–æ–∫, –∞–∫—Ü–µ–Ω—Ç–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.</p>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ -->
        <div class="settings-tab-content" data-tab="localization">
            <div class="settings-section">
                <h2 class="settings-section-title">üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏</h2>
                
                {% if not BABEL_AVAILABLE %}
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> Flask-Babel –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –î–ª—è —Ä–∞–±–æ—Ç—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: <code>pip install -r requirements.txt</code>
                </div>
                {% endif %}
                
                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label for="default_language" class="setting-label">
                                –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                            </label>
                            <span class="setting-badge">–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                        </div>
                        <div class="setting-card-body">
                            <small class="setting-hint">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</small>
                            <select 
                                id="default_language" 
                                name="default_language" 
                                class="setting-input"
                            >
                                {% for lang_code, lang_name in available_languages.items() %}
                                <option value="{{ lang_code }}" {% if default_language == lang_code %}selected{% endif %}>
                                    {{ lang_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label class="setting-label">–¢–µ–∫—É—â–∞—è –ª–æ–∫–∞–ª—å</label>
                            <span class="setting-badge">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                        </div>
                        <div class="setting-card-body">
                            <p><strong>–ê–∫—Ç–∏–≤–Ω—ã–π —è–∑—ã–∫:</strong> 
                                <span class="badge">{{ available_languages.get(current_locale, current_locale) }}</span>
                                <code>({{ current_locale }})</code>
                            </p>
                            <small class="setting-hint">
                                –¢–µ–∫—É—â–∏–π —è–∑—ã–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:<br>
                                1. –Ø–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ñ–∏–ª–µ (–µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω)<br>
                                2. –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã—à–µ)<br>
                                3. –†—É—Å—Å–∫–∏–π (—Å–∏—Å—Ç–µ–º–Ω—ã–π)
                            </small>
                        </div>
                    </div>
                    
                    <div class="setting-card">
                        <div class="setting-card-header">
                            <label class="setting-label">–î–æ—Å—Ç—É–ø–Ω—ã–µ —è–∑—ã–∫–∏</label>
                            <span class="setting-badge">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                        </div>
                        <div class="setting-card-body">
                            <ul class="language-list">
                                {% for lang_code, lang_name in available_languages.items() %}
                                <li>
                                    <strong>{{ lang_name }}</strong>
                                    <code>{{ lang_code }}</code>
                                    {% if lang_code == current_locale %}
                                    <span class="badge badge-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                            <small class="setting-hint">
                                –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —è–∑—ã–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ <code>app.py</code> –∏ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π URL hash
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.settings-tab');
    const tabContents = document.querySelectorAll('.settings-tab-content');
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–∞
    function switchTab(tabName) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ç–∞–±—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
        const selectedTab = document.querySelector(`.settings-tab[data-tab="${tabName}"]`);
        const selectedContent = document.querySelector(`.settings-tab-content[data-tab="${tabName}"]`);
        
        if (selectedTab && selectedContent) {
            selectedTab.classList.add('active');
            selectedContent.classList.add('active');
            // –û–±–Ω–æ–≤–ª—è–µ–º URL hash –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (window.location.hash !== '#' + tabName) {
                window.history.replaceState(null, '', '#' + tabName);
            }
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ç–∞–±–∞–º
    tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const targetTab = this.getAttribute('data-tab');
            switchTab(targetTab);
        });
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º hash –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const hash = window.location.hash.substring(1); // –£–±–∏—Ä–∞–µ–º #
    if (hash) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–± —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º
        const tabExists = Array.from(tabs).some(t => t.getAttribute('data-tab') === hash);
        if (tabExists) {
            switchTab(hash);
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è hash (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–Ω–æ–ø–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞)
    window.addEventListener('hashchange', function() {
        const newHash = window.location.hash.substring(1);
        if (newHash) {
            const tabExists = Array.from(tabs).some(t => t.getAttribute('data-tab') === newHash);
            if (tabExists) {
                switchTab(newHash);
            }
        }
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Dadata API
    const verifyDadataBtn = document.getElementById('verify-dadata-btn');
    const verifyStatus = document.getElementById('dadata-verify-status');
    const dadataEnabledCheckbox = document.getElementById('dadata_enabled');
    
    if (verifyDadataBtn) {
        verifyDadataBtn.addEventListener('click', function() {
            const apiKey = document.getElementById('dadata_api_key').value.trim();
            const secretKey = document.getElementById('dadata_secret_key').value.trim();
            
            if (!apiKey || !secretKey) {
                verifyStatus.textContent = '‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è';
                verifyStatus.className = 'verify-status error';
                return;
            }
            
            verifyDadataBtn.disabled = true;
            verifyDadataBtn.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            verifyStatus.textContent = '';
            verifyStatus.className = 'verify-status';
            
            const formData = new FormData();
            formData.append('api_key', apiKey);
            formData.append('secret_key', secretKey);
            
            fetch('{{ url_for("verify_dadata") }}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    verifyStatus.textContent = '‚úÖ ' + data.message;
                    verifyStatus.className = 'verify-status success';
                    if (dadataEnabledCheckbox) {
                        dadataEnabledCheckbox.disabled = false;
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        const hint = dadataEnabledCheckbox.closest('.setting-item').querySelector('.setting-hint');
                        if (hint) {
                            hint.textContent = '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞';
                        }
                    }
                } else {
                    verifyStatus.textContent = '‚ùå ' + data.message;
                    verifyStatus.className = 'verify-status error';
                    if (dadataEnabledCheckbox) {
                        dadataEnabledCheckbox.disabled = true;
                        dadataEnabledCheckbox.checked = false;
                        const hiddenInput = document.getElementById('dadata_enabled_hidden');
                        if (hiddenInput) {
                            hiddenInput.value = '0';
                        }
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                        const hint = dadataEnabledCheckbox.closest('.setting-item').querySelector('.setting-hint');
                        if (hint) {
                            hint.textContent = '–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏';
                        }
                    }
                }
            })
            .catch(error => {
                verifyStatus.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ: ' + error.message;
                verifyStatus.className = 'verify-status error';
            })
            .finally(() => {
                verifyDadataBtn.disabled = false;
                verifyDadataBtn.textContent = 'üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏';
            });
        });
    }
    });
    
    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è color picker –∏ text input –¥–ª—è —Ü–≤–µ—Ç–æ–≤
    const colorInputs = [
        { color: 'setting_accent_color', text: 'setting_accent_color_text', preview: 'preview_accent_color' },
        { color: 'setting_accent_color_hover', text: 'setting_accent_color_hover_text', preview: 'preview_accent_color_hover' },
        { color: 'setting_accent_color_dark', text: 'setting_accent_color_dark_text', preview: 'preview_accent_color_dark' },
        { color: 'setting_accent_color_hover_dark', text: 'setting_accent_color_hover_dark_text', preview: 'preview_accent_color_hover_dark' }
    ];
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é —Ü–≤–µ—Ç–∞
    function updateColorPreview(colorValue, previewId) {
        const preview = document.getElementById(previewId);
        if (preview) {
            preview.style.backgroundColor = colorValue;
            const text = preview.querySelector('.color-preview-text');
            if (text) {
                text.textContent = colorValue;
            }
        }
    }
    
    colorInputs.forEach(function(pair) {
        const colorInput = document.getElementById(pair.color);
        const textInput = document.getElementById(pair.text);
        
        if (colorInput && textInput) {
            // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ color picker –æ–±–Ω–æ–≤–ª—è–µ–º text input –∏ –ø—Ä–µ–≤—å—é
            colorInput.addEventListener('input', function() {
                const value = colorInput.value;
                textInput.value = value;
                updateColorPreview(value, pair.preview);
            });
            
            // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ text input –æ–±–Ω–æ–≤–ª—è–µ–º color picker –∏ –ø—Ä–µ–≤—å—é
            textInput.addEventListener('input', function() {
                const value = textInput.value.trim();
                if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
                    colorInput.value = value;
                    updateColorPreview(value, pair.preview);
                }
            });
        }
    });
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞ –≤ –ø–∞–ª–∏—Ç—Ä–µ
    function highlightCurrentColor(palette, currentColor) {
        palette.querySelectorAll('.color-palette-item').forEach(function(item) {
            const itemColor = item.getAttribute('data-color');
            item.classList.remove('selected');
            if (itemColor && itemColor.toLowerCase() === currentColor.toLowerCase()) {
                item.classList.add('selected');
            }
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –ø–∞–ª–∏—Ç—Ä–µ —Ü–≤–µ—Ç–æ–≤
    document.querySelectorAll('.color-palette-grid').forEach(function(palette) {
        const targetId = palette.getAttribute('data-target');
        const colorInput = document.getElementById(targetId);
        const textInput = document.getElementById(targetId + '_text');
        const previewId = 'preview_' + targetId;
        
        if (colorInput && textInput) {
            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ü–≤–µ—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const currentColor = colorInput.value;
            highlightCurrentColor(palette, currentColor);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ü–≤–µ—Ç–∞–º –≤ –ø–∞–ª–∏—Ç—Ä–µ
            palette.querySelectorAll('.color-palette-item').forEach(function(item) {
                item.addEventListener('click', function() {
                    const color = this.getAttribute('data-color');
                    if (color) {
                        colorInput.value = color;
                        textInput.value = color;
                        updateColorPreview(color, previewId);
                        
                        // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
                        highlightCurrentColor(palette, color);
                    }
                });
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ color picker –∏–ª–∏ text input
            colorInput.addEventListener('input', function() {
                highlightCurrentColor(palette, colorInput.value);
            });
            
            textInput.addEventListener('input', function() {
                const value = textInput.value.trim();
                if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
                    highlightCurrentColor(palette, value);
                }
            });
        }
    });
</script>

<style>
.language-list {
    list-style: none;
    padding: 0;
    margin: 1rem 0;
}

.language-list li {
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background: var(--bg-secondary);
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.language-list li strong {
    min-width: 120px;
}

.language-list li code {
    background: var(--bg-primary);
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.875rem;
}

.badge-active {
    background-color: #28a745;
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.875rem;
    margin-left: auto;
}

.alert {
    padding: 1rem;
    margin-bottom: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid;
}

.alert-warning {
    background-color: #fff3cd;
    border-color: #ffc107;
    color: #856404;
}

.alert code {
    background-color: rgba(0, 0, 0, 0.1);
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
}
</style>
{% endblock %}

