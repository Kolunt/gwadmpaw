{% extends "base.html" %}

{% block title %}{% if user %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% else %}–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endif %} - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>{% if user %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% else %}–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endif %}</h1>
        <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <div class="form-container">
        <form method="POST" class="user-form-compact">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section-compact">
                <h3 class="form-section-title">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="form-grid-compact">
                    <div class="form-group-compact">
                        <label for="user_id">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                        {% if user %}
                            <input type="text" id="user_id" name="user_id" value="{{ user.user_id }}" disabled>
                        {% else %}
                            <input type="number" id="user_id" name="user_id" required min="1" 
                                   placeholder="283494" value="{{ request.form.get('user_id', '') }}">
                        {% endif %}
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                        <input type="text" id="username" name="username" required 
                               value="{{ user.username if user else request.form.get('username', '') }}"
                               placeholder="_–ö–æ–ª—É–Ω—Ç_">
                    </div>
                
                <div class="form-group-compact">
                    <label for="language">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:</label>
                    {% set current_language = (user.language if user else request.form.get('language', 'ru')) or 'ru' %}
                    <select id="language" name="language">
                        {% for code, name in available_languages.items() %}
                        <option value="{{ code }}" {% if code == current_language %}selected{% endif %}>{{ name }}</option>
                        {% endfor %}
                    </select>
                </div>
                    
                    <div class="form-group-compact">
                        <label for="level">–£—Ä–æ–≤–µ–Ω—å:</label>
                        <input type="number" id="level" name="level" min="0" 
                               value="{{ user.level if user else request.form.get('level', '') }}"
                               placeholder="50">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="synd">–°–∏–Ω–¥–∏–∫–∞—Ç:</label>
                        <input type="number" id="synd" name="synd" min="0" 
                               value="{{ user.synd if user else request.form.get('synd', '') }}"
                               placeholder="5594">
                    </div>
                </div>
            </div>
            
            <!-- –î–∞–Ω–Ω—ã–µ GWars -->
            <div class="form-section-compact">
                <h3 class="form-section-title">‚öîÔ∏è –î–∞–Ω–Ω—ã–µ GWars</h3>
                <div class="form-grid-compact">
                    <div class="form-group-compact">
                        <label for="has_passport">–ï—Å—Ç—å –ø–∞—Å–ø–æ—Ä—Ç:</label>
                        <select id="has_passport" name="has_passport">
                            <option value="0" {% if not user or user.has_passport == 0 %}selected{% endif %}>–ù–µ—Ç</option>
                            <option value="1" {% if user and user.has_passport == 1 %}selected{% endif %}>–î–∞</option>
                        </select>
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="has_mobile">–ï—Å—Ç—å –º–æ–±–∏–ª—å–Ω—ã–π:</label>
                        <select id="has_mobile" name="has_mobile">
                            <option value="0" {% if not user or user.has_mobile == 0 %}selected{% endif %}>–ù–µ—Ç</option>
                            <option value="1" {% if user and user.has_mobile == 1 %}selected{% endif %}>–î–∞</option>
                        </select>
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="usersex">–ü–æ–ª:</label>
                        <select id="usersex" name="usersex">
                            <option value="0" {% if not user or user.usersex == '0' %}selected{% endif %}>–ú—É–∂—Å–∫–æ–π</option>
                            <option value="1" {% if user and user.usersex == '1' %}selected{% endif %}>–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </div>
                
                <div class="form-group-compact">
                    <label for="old_passport">–°—Ç–∞—Ä—ã–π –ø–∞—Å–ø–æ—Ä—Ç:</label>
                    <select id="old_passport" name="old_passport">
                        {% set current_old_passport = (user.old_passport if user is not none else request.form.get('old_passport', '0')) or 0 %}
                        <option value="0" {% if current_old_passport|int == 0 %}selected{% endif %}>–ù–µ—Ç</option>
                        <option value="1" {% if current_old_passport|int == 1 %}selected{% endif %}>–î–∞</option>
                    </select>
                </div>
                </div>
            </div>
            
        <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
        <div class="form-section-compact">
            <h3 class="form-section-title">üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
            <div class="form-grid-compact">
                <div class="form-group-compact">
                    <label for="last_name">–§–∞–º–∏–ª–∏—è:</label>
                    <input type="text" id="last_name" name="last_name"
                           value="{{ user.last_name if user else request.form.get('last_name', '') }}"
                           placeholder="–ò–≤–∞–Ω–æ–≤">
                </div>
                <div class="form-group-compact">
                    <label for="first_name">–ò–º—è:</label>
                    <input type="text" id="first_name" name="first_name"
                           value="{{ user.first_name if user else request.form.get('first_name', '') }}"
                           placeholder="–ò–≤–∞–Ω">
                </div>
                <div class="form-group-compact">
                    <label for="middle_name">–û—Ç—á–µ—Å—Ç–≤–æ:</label>
                    <input type="text" id="middle_name" name="middle_name"
                           value="{{ user.middle_name if user else request.form.get('middle_name', '') }}"
                           placeholder="–ò–≤–∞–Ω–æ–≤–∏—á">
                </div>
            </div>
        </div>
        
        <!-- –ê–¥—Ä–µ—Å -->
        <div class="form-section-compact">
            <h3 class="form-section-title">üè† –ê–¥—Ä–µ—Å</h3>
            <div class="form-grid-compact">
                <div class="form-group-compact">
                    <label for="postal_code">–ò–Ω–¥–µ–∫—Å:</label>
                    <input type="text" id="postal_code" name="postal_code"
                           value="{{ user.postal_code if user else request.form.get('postal_code', '') }}"
                           placeholder="123456">
                </div>
                <div class="form-group-compact">
                    <label for="country">–°—Ç—Ä–∞–Ω–∞:</label>
                    <input type="text" id="country" name="country"
                           value="{{ user.country if user else request.form.get('country', '') }}"
                           placeholder="–†–æ—Å—Å–∏—è">
                </div>
                <div class="form-group-compact">
                    <label for="city">–ì–æ—Ä–æ–¥:</label>
                    <input type="text" id="city" name="city"
                           value="{{ user.city if user else request.form.get('city', '') }}"
                           placeholder="–ú–æ—Å–∫–≤–∞">
                </div>
                <div class="form-group-compact">
                    <label for="street">–£–ª–∏—Ü–∞:</label>
                    <input type="text" id="street" name="street"
                           value="{{ user.street if user else request.form.get('street', '') }}"
                           placeholder="–õ–µ–Ω–∏–Ω–∞">
                </div>
                <div class="form-group-compact">
                    <label for="house">–î–æ–º:</label>
                    <input type="text" id="house" name="house"
                           value="{{ user.house if user else request.form.get('house', '') }}"
                           placeholder="10">
                </div>
                <div class="form-group-compact">
                    <label for="building">–ö–æ—Ä–ø—É—Å:</label>
                    <input type="text" id="building" name="building"
                           value="{{ user.building if user else request.form.get('building', '') }}"
                           placeholder="1">
                </div>
                <div class="form-group-compact">
                    <label for="apartment">–ö–≤–∞—Ä—Ç–∏—Ä–∞:</label>
                    <input type="text" id="apartment" name="apartment"
                           value="{{ user.apartment if user else request.form.get('apartment', '') }}"
                           placeholder="25">
                </div>
            </div>
        </div>
        
            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section-compact">
                <h3 class="form-section-title">‚ÑπÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="form-group-compact">
                    <label for="bio">–û —Å–µ–±–µ:</label>
                    <textarea id="bio" name="bio" rows="3" 
                              placeholder="–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ">{{ user.bio if user else request.form.get('bio', '') }}</textarea>
                </div>
                
                <div class="form-group-compact">
                    <label for="contact_info">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
                    <textarea id="contact_info" name="contact_info" rows="2" 
                              placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">{{ user.contact_info if user else request.form.get('contact_info', '') }}</textarea>
                </div>
            </div>
            
            <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
            <div class="form-section-compact">
                <h3 class="form-section-title">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                <div class="form-grid-compact">
                    <div class="form-group-compact">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" 
                               value="{{ user.email if user else request.form.get('email', '') }}"
                               placeholder="email@example.com">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                        <input type="text" id="phone" name="phone" 
                               value="{{ user.phone if user else request.form.get('phone', '') }}"
                               placeholder="+7 (999) 123-45-67">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="telegram">Telegram:</label>
                        <input type="text" id="telegram" name="telegram" 
                               value="{{ user.telegram if user else request.form.get('telegram', '') }}"
                               placeholder="@username">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="whatsapp">WhatsApp:</label>
                        <input type="text" id="whatsapp" name="whatsapp" 
                               value="{{ user.whatsapp if user else request.form.get('whatsapp', '') }}"
                               placeholder="+7 (999) 123-45-67">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="viber">Viber:</label>
                        <input type="text" id="viber" name="viber" 
                               value="{{ user.viber if user else request.form.get('viber', '') }}"
                               placeholder="+7 (999) 123-45-67">
                    </div>
                </div>
            </div>
        
        <!-- –ê–≤–∞—Ç–∞—Ä -->
        <div class="form-section-compact">
            <h3 class="form-section-title">üé® –ê–≤–∞—Ç–∞—Ä</h3>
            <div class="form-grid-compact">
                <div class="form-group-compact">
                    <label for="avatar_seed">Avatar seed:</label>
                    <input type="text" id="avatar_seed" name="avatar_seed"
                           value="{{ user.avatar_seed if user else request.form.get('avatar_seed', '') }}"
                           placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏">
                </div>
                <div class="form-group-compact">
                    <label for="avatar_style">–°—Ç–∏–ª—å –∞–≤–∞—Ç–∞—Ä–∞:</label>
                    {% set current_avatar_style = (user.avatar_style if user else request.form.get('avatar_style', 'avataaars')) or 'avataaars' %}
                    <select id="avatar_style" name="avatar_style">
                        {% for style in avatar_styles %}
                        <option value="{{ style }}" {% if style == current_avatar_style %}selected{% endif %}>{{ style }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {% if user %}–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% else %}–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endif %}
                </button>
                <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
        
        {% if user %}
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –∑–≤–∞–Ω–∏—è–º–∏ -->
        <div class="form-section-compact">
            <h3 class="form-section-title">üë§ –†–æ–ª–∏ –∏ –∑–≤–∞–Ω–∏—è</h3>
            
            <div class="roles-titles-grid">
                <div class="roles-titles-column">
                    <h4>–†–æ–ª–∏</h4>
                    <div class="current-badges">
                        {% if user_roles %}
                            {% for role in user_roles %}
                                <span class="role-badge">{{ role.display_name }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">–ù–µ—Ç —Ä–æ–ª–µ–π</span>
                        {% endif %}
                    </div>
                    
                    <div class="roles-titles-actions">
                        <form method="POST" class="role-form-compact">
                            <input type="hidden" name="role_action" value="assign">
                            <select name="role_name" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                                {% for role in all_roles %}
                                    {% if role.name not in user_role_names %}
                                    <option value="{{ role.name }}">{{ role.display_name }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-primary btn-sm">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                        </form>
                        
                        {% if user_roles %}
                        <form method="POST" class="role-form-compact">
                            <input type="hidden" name="role_action" value="remove">
                            <select name="role_name" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                                {% for role in user_roles %}
                                <option value="{{ role.name }}">{{ role.display_name }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                
                <div class="roles-titles-column">
                    <h4>–ó–≤–∞–Ω–∏—è</h4>
                    <div class="current-badges">
                        {% if user_titles %}
                            {% for title in user_titles %}
                                <span class="title-badge" style="background-color: {{ title.color }}20; color: {{ title.color }}; border-color: {{ title.color }};">
                                    {% if title.icon %}{{ title.icon }} {% endif %}{{ title.display_name }}
                                </span>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">–ù–µ—Ç –∑–≤–∞–Ω–∏–π</span>
                        {% endif %}
                    </div>
                    
                    <div class="roles-titles-actions">
                        <form method="POST" class="role-form-compact">
                            <input type="hidden" name="title_action" value="assign">
                            <select name="title_id" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–≤–∞–Ω–∏–µ</option>
                                {% for title in all_titles %}
                                    {% if title.id not in user_title_ids %}
                                    <option value="{{ title.id }}">
                                        {% if title.icon %}{{ title.icon }} {% endif %}{{ title.display_name }}
                                    </option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-primary btn-sm">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                        </form>
                        
                        {% if user_titles %}
                        <form method="POST" class="role-form-compact">
                            <input type="hidden" name="title_action" value="remove">
                            <select name="title_id" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–≤–∞–Ω–∏–µ</option>
                                {% for title in user_titles %}
                                <option value="{{ title.id }}">
                                    {% if title.icon %}{{ title.icon }} {% endif %}{{ title.display_name }}
                                </option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

