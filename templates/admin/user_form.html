{% extends "base.html" %}

{% block title %}{% if user %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% else %}–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endif %} - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>{% if user %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% else %}–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endif %}</h1>
        <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <div class="form-container">
        <form method="POST" class="user-form-compact">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section-compact">
                <h3 class="form-section-title">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="form-grid-compact">
                    <div class="form-group-compact">
                        <label for="user_id">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                        {% if user %}
                            <input type="text" id="user_id" name="user_id" value="{{ user.user_id }}" disabled>
                        {% else %}
                            <input type="number" id="user_id" name="user_id" required min="1" 
                                   placeholder="283494" value="{{ request.form.get('user_id', '') }}">
                        {% endif %}
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                        <input type="text" id="username" name="username" required 
                               value="{{ user.username if user else request.form.get('username', '') }}"
                               placeholder="_–ö–æ–ª—É–Ω—Ç_">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="level">–£—Ä–æ–≤–µ–Ω—å:</label>
                        <input type="number" id="level" name="level" min="0" 
                               value="{{ user.level if user else request.form.get('level', '') }}"
                               placeholder="50">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="synd">–°–∏–Ω–¥–∏–∫–∞—Ç:</label>
                        <input type="number" id="synd" name="synd" min="0" 
                               value="{{ user.synd if user else request.form.get('synd', '') }}"
                               placeholder="5594">
                    </div>
                </div>
            </div>
            
            <!-- –î–∞–Ω–Ω—ã–µ GWars -->
            <div class="form-section-compact">
                <h3 class="form-section-title">‚öîÔ∏è –î–∞–Ω–Ω—ã–µ GWars</h3>
                <div class="form-grid-compact">
                    <div class="form-group-compact">
                        <label for="has_passport">–ï—Å—Ç—å –ø–∞—Å–ø–æ—Ä—Ç:</label>
                        <select id="has_passport" name="has_passport">
                            <option value="0" {% if not user or user.has_passport == 0 %}selected{% endif %}>–ù–µ—Ç</option>
                            <option value="1" {% if user and user.has_passport == 1 %}selected{% endif %}>–î–∞</option>
                        </select>
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="has_mobile">–ï—Å—Ç—å –º–æ–±–∏–ª—å–Ω—ã–π:</label>
                        <select id="has_mobile" name="has_mobile">
                            <option value="0" {% if not user or user.has_mobile == 0 %}selected{% endif %}>–ù–µ—Ç</option>
                            <option value="1" {% if user and user.has_mobile == 1 %}selected{% endif %}>–î–∞</option>
                        </select>
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="usersex">–ü–æ–ª:</label>
                        <select id="usersex" name="usersex">
                            <option value="0" {% if not user or user.usersex == '0' %}selected{% endif %}>–ú—É–∂—Å–∫–æ–π</option>
                            <option value="1" {% if user and user.usersex == '1' %}selected{% endif %}>–ñ–µ–Ω—Å–∫–∏–π</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section-compact">
                <h3 class="form-section-title">‚ÑπÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <div class="form-group-compact">
                    <label for="bio">–û —Å–µ–±–µ:</label>
                    <textarea id="bio" name="bio" rows="3" 
                              placeholder="–ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ">{{ user.bio if user else request.form.get('bio', '') }}</textarea>
                </div>
                
                <div class="form-group-compact">
                    <label for="contact_info">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
                    <textarea id="contact_info" name="contact_info" rows="2" 
                              placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">{{ user.contact_info if user else request.form.get('contact_info', '') }}</textarea>
                </div>
            </div>
            
            <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
            <div class="form-section-compact">
                <h3 class="form-section-title">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                <div class="form-grid-compact">
                    <div class="form-group-compact">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email" 
                               value="{{ user.email if user else request.form.get('email', '') }}"
                               placeholder="email@example.com">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                        <input type="text" id="phone" name="phone" 
                               value="{{ user.phone if user else request.form.get('phone', '') }}"
                               placeholder="+7 (999) 123-45-67">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="telegram">Telegram:</label>
                        <input type="text" id="telegram" name="telegram" 
                               value="{{ user.telegram if user else request.form.get('telegram', '') }}"
                               placeholder="@username">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="whatsapp">WhatsApp:</label>
                        <input type="text" id="whatsapp" name="whatsapp" 
                               value="{{ user.whatsapp if user else request.form.get('whatsapp', '') }}"
                               placeholder="+7 (999) 123-45-67">
                    </div>
                    
                    <div class="form-group-compact">
                        <label for="viber">Viber:</label>
                        <input type="text" id="viber" name="viber" 
                               value="{{ user.viber if user else request.form.get('viber', '') }}"
                               placeholder="+7 (999) 123-45-67">
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {% if user %}–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% else %}–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è{% endif %}
                </button>
                <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
            </div>
        </form>
        
        {% if user %}
        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –∑–≤–∞–Ω–∏—è–º–∏ -->
        <div class="form-section-compact">
            <h3 class="form-section-title">üë§ –†–æ–ª–∏ –∏ –∑–≤–∞–Ω–∏—è</h3>
            
            <div class="roles-titles-grid">
                <div class="roles-titles-column">
                    <h4>–†–æ–ª–∏</h4>
                    <div class="current-badges">
                        {% if user_roles %}
                            {% for role in user_roles %}
                                <span class="role-badge">{{ role.display_name }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">–ù–µ—Ç —Ä–æ–ª–µ–π</span>
                        {% endif %}
                    </div>
                    
                    <div class="roles-titles-actions">
                        <form method="POST" class="role-form-compact">
                            <input type="hidden" name="role_action" value="assign">
                            <select name="role_name" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                                {% for role in all_roles %}
                                    {% if role.name not in user_role_names %}
                                    <option value="{{ role.name }}">{{ role.display_name }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-primary btn-sm">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                        </form>
                        
                        {% if user_roles %}
                        <form method="POST" class="role-form-compact">
                            <input type="hidden" name="role_action" value="remove">
                            <select name="role_name" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
                                {% for role in user_roles %}
                                <option value="{{ role.name }}">{{ role.display_name }}</option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                
                <div class="roles-titles-column">
                    <h4>–ó–≤–∞–Ω–∏—è</h4>
                    <div class="current-badges">
                        {% if user_titles %}
                            {% for title in user_titles %}
                                <span class="title-badge" style="background-color: {{ title.color }}20; color: {{ title.color }}; border-color: {{ title.color }};">
                                    {% if title.icon %}{{ title.icon }} {% endif %}{{ title.display_name }}
                                </span>
                            {% endfor %}
                        {% else %}
                            <span class="text-muted">–ù–µ—Ç –∑–≤–∞–Ω–∏–π</span>
                        {% endif %}
                    </div>
                    
                    <div class="roles-titles-actions">
                        <form method="POST" class="role-form-compact">
                            <input type="hidden" name="title_action" value="assign">
                            <select name="title_id" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–≤–∞–Ω–∏–µ</option>
                                {% for title in all_titles %}
                                    {% if title.id not in user_title_ids %}
                                    <option value="{{ title.id }}">
                                        {% if title.icon %}{{ title.icon }} {% endif %}{{ title.display_name }}
                                    </option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-primary btn-sm">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
                        </form>
                        
                        {% if user_titles %}
                        <form method="POST" class="role-form-compact">
                            <input type="hidden" name="title_action" value="remove">
                            <select name="title_id" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–≤–∞–Ω–∏–µ</option>
                                {% for title in user_titles %}
                                <option value="{{ title.id }}">
                                    {% if title.icon %}{{ title.icon }} {% endif %}{{ title.display_name }}
                                </option>
                                {% endfor %}
                            </select>
                            <button type="submit" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

