{% extends "base.html" %}

{% block title %}{% if event %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ{% else %}–°–æ–∑–¥–∞–Ω–∏–µ{% endif %} –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>{% if event %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è{% else %}–°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è{% endif %}</h1>
        <a href="{{ url_for('admin_events') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <form method="POST" class="event-form">
        <div class="form-section">
            <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            
            <div class="form-group">
                <label for="name" class="form-label">
                    –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è <span class="required">*</span>
                </label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    value="{{ event.name if event else '' }}"
                    class="form-input"
                    required
                    placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è"
                >
            </div>
            
            <div class="form-group">
                <label for="description" class="form-label">
                    –û–ø–∏—Å–∞–Ω–∏–µ
                </label>
                <textarea 
                    id="description" 
                    name="description" 
                    class="form-textarea"
                    rows="4"
                    placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è..."
                >{{ event.description if event else '' }}</textarea>
            </div>
            
            <div class="form-group">
                <label for="award_id" class="form-label">
                    –ù–∞–≥—Ä–∞–¥–∞ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>
                </label>
                <select 
                    id="award_id" 
                    name="award_id" 
                    class="form-input"
                >
                    <option value="">–ù–µ –≤—ã–¥–∞–≤–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—É</option>
                    {% if awards %}
                        {% for award in awards %}
                            <option value="{{ award.id }}" {% if event and event.award_id == award.id %}selected{% endif %}>
                                {{ award.title }}
                            </option>
                        {% endfor %}
                    {% endif %}
                </select>
                <small class="form-hint">–ù–∞–≥—Ä–∞–¥–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–∞–Ω–∞ –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –ø–æ—Å–ª–µ –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</small>
            </div>
        </div>
        
        <div class="form-section">
            <h3>üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–ë—É–±–µ–Ω—á–∏–∫–∏)</h3>
            <p class="form-hint">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–±–µ–Ω—á–∏–∫–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è. –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞".</p>
            
            <div class="form-group">
                <label for="rating_registration" class="form-label">
                    –ë—É–±–µ–Ω—á–∏–∫–∏ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                    <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>
                </label>
                <input 
                    type="number" 
                    id="rating_registration" 
                    name="rating_registration" 
                    value="{{ event.rating_registration if event and event.rating_registration is not none else '' }}"
                    class="form-input"
                    step="1"
                    placeholder="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É"
                >
                <small class="form-hint">–û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</small>
            </div>
            
            <div class="form-group">
                <label for="rating_gift_not_sent" class="form-label">
                    –ë—É–±–µ–Ω—á–∏–∫–∏ –∑–∞ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                    <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>
                </label>
                <input 
                    type="number" 
                    id="rating_gift_not_sent" 
                    name="rating_gift_not_sent" 
                    value="{{ event.rating_gift_not_sent if event and event.rating_gift_not_sent is not none else '' }}"
                    class="form-input"
                    step="1"
                    placeholder="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É"
                >
                <small class="form-hint">–û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</small>
            </div>
            
            <div class="form-group">
                <label for="rating_gift_sent" class="form-label">
                    –ë—É–±–µ–Ω—á–∏–∫–∏ –∑–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                    <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>
                </label>
                <input 
                    type="number" 
                    id="rating_gift_sent" 
                    name="rating_gift_sent" 
                    value="{{ event.rating_gift_sent if event and event.rating_gift_sent is not none else '' }}"
                    class="form-input"
                    step="1"
                    placeholder="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É"
                >
                <small class="form-hint">–û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</small>
            </div>
            
            <div class="form-group">
                <label for="rating_order_coefficient" class="form-label">
                    –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞
                    <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>
                </label>
                <input 
                    type="number" 
                    id="rating_order_coefficient" 
                    name="rating_order_coefficient" 
                    value="{{ event.rating_order_coefficient if event and event.rating_order_coefficient is not none else '' }}"
                    class="form-input"
                    step="0.1"
                    min="0"
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1"
                >
                <small class="form-hint">
                    –ë—É–±–µ–Ω—á–∏–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ: (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ - –ø–æ—Ä—è–¥–∫–æ–≤—ã–π_–Ω–æ–º–µ—Ä + 1) √ó –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç.
                    –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ 158 —É—á–∞—Å—Ç–Ω–∏–∫–∞—Ö –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–µ 1: –ø–µ—Ä–≤—ã–π –ø–æ–ª—É—á–∏—Ç 158 –±—É–±–µ–Ω—á–∏–∫–æ–≤, –ø–æ—Å–ª–µ–¥–Ω–∏–π ‚Äî 1.
                </small>
            </div>
        </div>
        
        <div class="form-section">
            <h3>–≠—Ç–∞–ø—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>
            <p class="form-hint">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞. –≠—Ç–∞–ø—ã —Å –ø–æ–º–µ—Ç–∫–æ–π <span class="required">*</span> –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.</p>
            
            {% for stage in stages %}
            <div class="stage-form-group">
                <div class="stage-header">
                    <h4>
                        {{ stage.name }}
                        {% if stage.required %}<span class="required">*</span>{% endif %}
                        {% if not stage.required %}<span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>{% endif %}
                    </h4>
                </div>
                
                <div class="stage-fields">
                    {% set existing_stage = existing_stages.get(stage.type) if existing_stages else None %}
                    
                    {% if stage.has_start %}
                    <div class="form-group">
                        <label for="stage_{{ stage.type }}_start" class="form-label">
                            –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
                            {% if stage.required %}<span class="required">*</span>{% endif %}
                        </label>
                        <input 
                            type="datetime-local" 
                            id="stage_{{ stage.type }}_start" 
                            name="stage_{{ stage.type }}_start" 
                            value="{% if existing_stage and existing_stage.start_datetime %}{{ existing_stage.start_datetime.replace(' ', 'T')[:16] }}{% endif %}"
                            class="form-input"
                            {% if stage.required %}required{% endif %}
                        >
                        <small class="form-hint">–≠—Ç–∞–ø –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, –∫–æ–≥–¥–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø</small>
                    </div>
                    {% endif %}
                    
                    {% if stage.has_end %}
                    <div class="form-group">
                        <label for="stage_{{ stage.type }}_end" class="form-label">
                            –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
                            {% if stage.required %}<span class="required">*</span>{% endif %}
                        </label>
                        <input 
                            type="datetime-local" 
                            id="stage_{{ stage.type }}_end" 
                            name="stage_{{ stage.type }}_end" 
                            value="{% if existing_stage and existing_stage.end_datetime %}{{ existing_stage.end_datetime.replace(' ', 'T')[:16] }}{% endif %}"
                            class="form-input"
                            {% if stage.required %}required{% endif %}
                        >
                    </div>
                    {% endif %}
                    
                    {% if not stage.has_start and not stage.has_end %}
                    <div class="form-group">
                        <p class="stage-info">–≠—Ç–∞–ø –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–µ–Ω –¥–æ –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç—Ç–∞–ø–∞</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {% if event %}–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% else %}–°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ{% endif %}
            </button>
            <a href="{{ url_for('admin_events') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>
{% endblock %}

