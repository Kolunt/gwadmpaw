{% extends "base.html" %}

{% block title %}–ë—É–±–µ–Ω—á–∏–∫–∏ - {{ user.username or ('ID ' ~ user.user_id) }}{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="admin-container">
        <div class="admin-header">
            <div>
                <h1>üîî –ë—É–±–µ–Ω—á–∏–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h1>
                <p class="text-muted" style="margin: 0;">
                    {{ user.username or ('ID ' ~ user.user_id) }} ¬∑ ID {{ user.user_id }}
                </p>
            </div>
            <div style="display: flex; gap: 0.75rem;">
                <a href="{{ url_for('user_rating') }}" class="btn btn-secondary">‚Üê –ö —Ä–µ–π—Ç–∏–Ω–≥—É</a>
                <a href="{{ url_for('view_profile', user_id=user.user_id) }}" class="btn btn-outline-secondary">–ü—Ä–æ—Ñ–∏–ª—å</a>
            </div>
        </div>

        <div class="event-view-card">
            <h2 style="margin-bottom: 1rem;">–ò—Ç–æ–≥–æ–≤—ã–µ –±—É–±–µ–Ω—á–∏–∫–∏: {{ active_count }}</h2>

            {% if events %}
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
                            <th>–ü—Ä–∏—á–∏–Ω–∞</th>
                            <th style="width: 7rem;">–ë—É–±–µ–Ω—á–∏–∫–æ–≤</th>
                            <th style="width: 8rem;">–°—Ç–∞—Ç—É—Å</th>
                            <th style="width: 11rem;">–í—ã–¥–∞–Ω–æ</th>
                            <th style="width: 11rem;">–û–±–Ω–æ–≤–ª–µ–Ω–æ</th>
                            <th style="width: 11rem;">–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–æ</th>
                            <th style="width: 10rem;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for event in events %}
                        <tr>
                            <td data-label="–ò—Å—Ç–æ—á–Ω–∏–∫">
                                {{ event.source_label }}
                            </td>
                            <td data-label="–ü—Ä–∏—á–∏–Ω–∞">
                                {{ event.reason }}
                            </td>
                            <td data-label="–ë—É–±–µ–Ω—á–∏–∫–æ–≤">
                                <strong class="{% if event.points < 0 %}text-danger{% elif event.points > 0 %}text-success{% endif %}">
                                    {{ event.points }}
                                </strong>
                            </td>
                            <td data-label="–°—Ç–∞—Ç—É—Å">
                                {% if event.active %}
                                <span class="badge badge-success">–ê–∫—Ç–∏–≤–Ω–∞</span>
                                {% elif event.manual_revoked %}
                                <span class="badge badge-danger">–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∞</span>
                                {% else %}
                                <span class="badge badge-secondary">–û—Ç–∫–ª—é—á–µ–Ω–∞</span>
                                {% endif %}
                            </td>
                            <td data-label="–í—ã–¥–∞–Ω–æ">
                                {{ event.created_at or '‚Äî' }}
                            </td>
                            <td data-label="–û–±–Ω–æ–≤–ª–µ–Ω–æ">
                                {{ event.updated_at or '‚Äî' }}
                            </td>
                            <td data-label="–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–æ">
                                {{ event.revoked_at or '‚Äî' }}
                            </td>
                            <td data-label="–î–µ–π—Å—Ç–≤–∏—è">
                                {% if event.active %}
                                <form method="post" action="{{ url_for('admin_rating_event_annul', event_id=event.id) }}" onsubmit="return confirm('–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –±—É–±–µ–Ω—á–∏–∫?');">
                                    <button type="submit" class="btn btn-outline-danger btn-sm">–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å</button>
                                </form>
                                {% else %}
                                    {% if event.manual_revoked %}
                                    <form method="post" action="{{ url_for('admin_rating_event_restore', event_id=event.id) }}" onsubmit="return confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—É–±–µ–Ω—á–∏–∫?');">
                                        <button type="submit" class="btn btn-outline-success btn-sm">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                                    </form>
                                    {% else %}
                                    <span class="text-muted">–ê–≤—Ç–æ-–æ—Ç–∫–ª—é—á–µ–Ω–∞</span>
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <p>–î–ª—è —ç—Ç–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –±—É–±–µ–Ω—á–∏–∫–∞—Ö.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

