{% extends "base.html" %}

{% block title %}–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–¶—ã—Ñ–æ—Ä–∫–∏) - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ (–¶—ã—Ñ–æ—Ä–∫–∏)</h1>
        <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
    </div>
    
    <form method="POST" class="settings-form">
        <div class="settings-section">
            <p class="text-muted" style="margin-bottom: 1.5rem;">
                –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—á–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∑–∞ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.
            </p>

            <!-- –¢–∞–±—ã -->
            <div class="settings-tabs">
                <a href="#contacts" class="settings-tab active" data-tab="contacts">
                    üì± –ö–æ–Ω—Ç–∞–∫—Ç—ã
                </a>
                <a href="#events" class="settings-tab" data-tab="events">
                    üéâ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
                </a>
                {% if awards %}
                <a href="#awards" class="settings-tab" data-tab="awards">
                    üèÜ –ù–∞–≥—Ä–∞–¥—ã
                </a>
                {% endif %}
                {% if titles %}
                <a href="#titles" class="settings-tab" data-tab="titles">
                    ‚≠ê –ó–≤–∞–Ω–∏—è
                </a>
                {% endif %}
            </div>

            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–æ–≤ -->
            <!-- –¢–∞–±: –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
            <div class="settings-tab-content active" data-tab="contacts">
                <div class="setting-card">
                    <div class="setting-card-header">
                        <h3 class="setting-card-title">üì± –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                        <span class="setting-badge">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
                    </div>
                    <div class="setting-card-body">
                        <p class="setting-hint" style="margin-bottom: 1rem;">
                            –û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ –ø—Ä–æ—Ñ–∏–ª–µ
                        </p>
                        
                        {% set rating_telegram = settings_dict.get('rating_contact_telegram', {}) %}
                        <div class="setting-item">
                            <label for="rating_contact_telegram" class="setting-label">
                                Telegram
                                <small class="setting-hint">–û—á–∫–∏ –∑–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π Telegram</small>
                            </label>
                            <input 
                                type="number" 
                                id="rating_contact_telegram" 
                                name="setting_rating_contact_telegram" 
                                value="{{ rating_telegram.get('value', '1') if rating_telegram else '1' }}"
                                class="setting-input"
                                step="1"
                            >
                        </div>
                        
                        {% set rating_whatsapp = settings_dict.get('rating_contact_whatsapp', {}) %}
                        <div class="setting-item">
                            <label for="rating_contact_whatsapp" class="setting-label">
                                WhatsApp
                                <small class="setting-hint">–û—á–∫–∏ –∑–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π WhatsApp</small>
                            </label>
                            <input 
                                type="number" 
                                id="rating_contact_whatsapp" 
                                name="setting_rating_contact_whatsapp" 
                                value="{{ rating_whatsapp.get('value', '1') if rating_whatsapp else '1' }}"
                                class="setting-input"
                                step="1"
                            >
                        </div>
                        
                        {% set rating_viber = settings_dict.get('rating_contact_viber', {}) %}
                        <div class="setting-item">
                            <label for="rating_contact_viber" class="setting-label">
                                Viber
                                <small class="setting-hint">–û—á–∫–∏ –∑–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π Viber</small>
                            </label>
                            <input 
                                type="number" 
                                id="rating_contact_viber" 
                                name="setting_rating_contact_viber" 
                                value="{{ rating_viber.get('value', '1') if rating_viber else '1' }}"
                                class="setting-input"
                                step="1"
                            >
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢–∞–±: –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
            <div class="settings-tab-content" data-tab="events">
                <div class="setting-card">
                    <div class="setting-card-header">
                        <h3 class="setting-card-title">üéâ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>
                        <span class="setting-badge">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</span>
                    </div>
                    <div class="setting-card-body">
                        <p class="setting-hint" style="margin-bottom: 1rem;">
                            –û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                        </p>
                        
                        {% set rating_registration = settings_dict.get('rating_event_registration', {}) %}
                        <div class="setting-item">
                            <label for="rating_event_registration" class="setting-label">
                                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
                                <small class="setting-hint">
                                    –û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º, –∫–æ–≥–¥–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ (—ç—Ç–∞–ø "–ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"). 
                                    –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∫ —ç—Ç–∞–ø—É –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
                                </small>
                            </label>
                            <input 
                                type="number" 
                                id="rating_event_registration" 
                                name="setting_rating_event_registration" 
                                value="{{ rating_registration.get('value', '1') if rating_registration else '1' }}"
                                class="setting-input"
                                step="1"
                            >
                        </div>
                        
                        {% set rating_gift_not_sent = settings_dict.get('rating_event_gift_not_sent', {}) %}
                        <div class="setting-item">
                            <label for="rating_event_gift_not_sent" class="setting-label">
                                –ë—É–±–µ–Ω—á–∏–∫–∏ –∑–∞ –Ω–µ–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                                <small class="setting-hint">
                                    –û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–æ–¥–∞—Ä–æ–∫ (–Ω–µ –æ—Ç–º–µ—Ç–∏–ª–∏ "–û—Ç–ø—Ä–∞–≤–∏–ª –ø–æ–¥–∞—Ä–æ–∫"). 
                                    –ï—Å–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞), –±—É–±–µ–Ω—á–∏–∫–∏ —Å–Ω–∏–º–∞—é—Ç—Å—è –∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏.
                                </small>
                            </label>
                            <input 
                                type="number" 
                                id="rating_event_gift_not_sent" 
                                name="setting_rating_event_gift_not_sent" 
                                value="{{ rating_gift_not_sent.get('value', '0') if rating_gift_not_sent else '0' }}"
                                class="setting-input"
                                step="1"
                            >
                        </div>
                        
                        {% set rating_gift_sent = settings_dict.get('rating_event_gift_sent', {}) %}
                        <div class="setting-item">
                            <label for="rating_event_gift_sent" class="setting-label">
                                –ë—É–±–µ–Ω—á–∏–∫–∏ –∑–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫
                                <small class="setting-hint">
                                    –û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–æ–¥–∞—Ä–æ–∫ (–æ—Ç–º–µ—Ç–∏–ª–∏ "–û—Ç–ø—Ä–∞–≤–∏–ª –ø–æ–¥–∞—Ä–æ–∫"). 
                                    –ï—Å–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞), –±—É–±–µ–Ω—á–∏–∫–∏ —Å–Ω–∏–º–∞—é—Ç—Å—è –∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–∫—Ä—ã—Ç–∏–∏.
                                </small>
                            </label>
                            <input 
                                type="number" 
                                id="rating_event_gift_sent" 
                                name="setting_rating_event_gift_sent" 
                                value="{{ rating_gift_sent.get('value', '0') if rating_gift_sent else '0' }}"
                                class="setting-input"
                                step="1"
                            >
                        </div>
                    </div>
                </div>
            </div>

            <!-- –¢–∞–±: –ù–∞–≥—Ä–∞–¥—ã -->
            {% if awards %}
            <div class="settings-tab-content" data-tab="awards">
                <div class="setting-card">
                    <div class="setting-card-header">
                        <h3 class="setting-card-title">üèÜ –ù–∞–≥—Ä–∞–¥—ã</h3>
                        <span class="setting-badge">–ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏</span>
                    </div>
                    <div class="setting-card-body">
                        <p class="setting-hint" style="margin-bottom: 1rem;">
                            –û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä–∞–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                        </p>
                        
                        {% for award in awards %}
                        {% set award_key = 'rating_award_' ~ award.id %}
                        {% set award_setting = settings_dict.get(award_key, {}) %}
                        <div class="setting-item">
                            <label for="{{ award_key }}" class="setting-label">
                                {{ award.icon or 'üèÜ' }} {{ award.title }}
                                <small class="setting-hint">–û—á–∫–∏ –∑–∞ –Ω–∞–≥—Ä–∞–¥—É "{{ award.title }}"</small>
                            </label>
                            <input 
                                type="number" 
                                id="{{ award_key }}" 
                                name="setting_{{ award_key }}" 
                                value="{{ award_setting.get('value', '0') if award_setting else '0' }}"
                                class="setting-input"
                                step="1"
                            >
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- –¢–∞–±: –ó–≤–∞–Ω–∏—è -->
            {% if titles %}
            <div class="settings-tab-content" data-tab="titles">
                <div class="setting-card">
                    <div class="setting-card-header">
                        <h3 class="setting-card-title">‚≠ê –ó–≤–∞–Ω–∏—è</h3>
                        <span class="setting-badge">–ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏</span>
                    </div>
                    <div class="setting-card-body">
                        <p class="setting-hint" style="margin-bottom: 1rem;">
                            –û—á–∫–∏ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                        </p>
                        
                        {% for title in titles %}
                        {% set title_key = 'rating_title_' ~ title.id %}
                        {% set title_setting = settings_dict.get(title_key, {}) %}
                        <div class="setting-item">
                            <label for="{{ title_key }}" class="setting-label">
                                {{ title.icon or '‚≠ê' }} {{ title.display_name }}
                                <small class="setting-hint">–û—á–∫–∏ –∑–∞ –∑–≤–∞–Ω–∏–µ "{{ title.display_name }}"</small>
                            </label>
                            <input 
                                type="number" 
                                id="{{ title_key }}" 
                                name="setting_{{ title_key }}" 
                                value="{{ title_setting.get('value', '0') if title_setting else '0' }}"
                                class="setting-input"
                                step="1"
                            >
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        
        <input type="hidden" name="action" id="form-action" value="save">
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary" onclick="document.getElementById('form-action').value='save';">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button type="submit" class="btn btn-warning" onclick="if(confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç –≤—Å–µ —É–∂–µ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –æ—á–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.')) { document.getElementById('form-action').value='update'; } else { return false; }">–û–±–Ω–æ–≤–∏—Ç—å –∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</button>
            <form method="POST" action="{{ url_for('admin_rating_settings_fix_points') }}" style="display: inline;" onsubmit="return confirm('–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è points –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö? –≠—Ç–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —á–∏—Å–ª–∞.');">
                <button type="submit" class="btn btn-outline-warning">–ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î</button>
            </form>
            <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.settings-tab');
    const tabContents = document.querySelectorAll('.settings-tab-content');
    
    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∞–±–æ–≤
    function switchTab(tabName) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —Ç–∞–±–æ–≤ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(content => content.classList.remove('active'));
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–± –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
        const selectedTab = document.querySelector(`.settings-tab[data-tab="${tabName}"]`);
        const selectedContent = document.querySelector(`.settings-tab-content[data-tab="${tabName}"]`);
        
        if (selectedTab && selectedContent) {
            selectedTab.classList.add('active');
            selectedContent.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (window.location.hash !== '#' + tabName) {
                window.history.replaceState(null, '', '#' + tabName);
            }
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ —Ç–∞–±—ã
    tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            const targetTab = this.getAttribute('data-tab');
            switchTab(targetTab);
        });
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º hash –≤ URL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const hash = window.location.hash.substring(1);
    if (hash) {
        const tabExists = Array.from(tabs).some(t => t.getAttribute('data-tab') === hash);
        if (tabExists) {
            switchTab(hash);
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è hash
    window.addEventListener('hashchange', function() {
        const newHash = window.location.hash.substring(1);
        if (newHash) {
            const tabExists = Array.from(tabs).some(t => t.getAttribute('data-tab') === newHash);
            if (tabExists) {
                switchTab(newHash);
            }
        }
    });
});
</script>
{% endblock %}
