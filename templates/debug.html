{% extends "base.html" %}

{% block title %}Отладка - GWars Auth{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="profile-card">
        <h2>Отладочная информация</h2>
        
        {% if debug_info %}
        <div class="debug-info">
            <h3>Исходные данные:</h3>
            <div class="info-row">
                <span class="info-label">Пароль (для подписи):</span>
                <span class="info-value"><code>{{ debug_info.password }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Имя (закодированное):</span>
                <span class="info-value"><code>{{ debug_info.encoded_name }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Имя (декодированное UTF-8):</span>
                <span class="info-value"><code>{{ debug_info.decoded_name }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Имя (декодированное CP1251):</span>
                <span class="info-value"><code>{{ debug_info.decoded_name_cp1251 }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Имя (декодированное Latin1):</span>
                <span class="info-value"><code>{{ debug_info.decoded_name_latin1 }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Имя (из request.args):</span>
                <span class="info-value"><code>{{ debug_info.name_from_args }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">User ID:</span>
                <span class="info-value"><code>{{ debug_info.user_id }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Query String:</span>
                <span class="info-value"><code style="font-size: 0.8rem; word-break: break-all;">{{ debug_info.query_string }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Full URL:</span>
                <span class="info-value"><code style="font-size: 0.8rem; word-break: break-all;">{{ debug_info.full_url }}</code></span>
            </div>
            
            <h3>Варианты вычисления подписи sign:</h3>
            
            <div class="info-row">
                <span class="info-label" style="font-weight: bold; color: var(--accent-color);">Вариант BYTES (pass + raw_bytes + id) - ПРАВИЛЬНЫЙ:</span>
                <span class="info-value"><code>{{ debug_info.variant_bytes }}</code></span>
                <span style="color: {% if debug_info.sign_match_bytes %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px; font-size: 1.2em;">
                    {% if debug_info.sign_match_bytes %}✅ СОВПАДАЕТ!{% else %}❌{% endif %}
                </span>
            </div>
            
            <div class="info-row">
                <span class="info-label">Вариант 1 (pass + decoded_name + id):</span>
                <span class="info-value"><code>{{ debug_info.variant1 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v1 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v1 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            
            <div class="info-row">
                <span class="info-label">Вариант 2 (pass + encoded_name + id):</span>
                <span class="info-value"><code>{{ debug_info.variant2 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v2 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v2 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            
            <div class="info-row">
                <span class="info-label">Вариант 3 (pass + id + decoded_name):</span>
                <span class="info-value"><code>{{ debug_info.variant3 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v3 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v3 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            
            <div class="info-row">
                <span class="info-label">Вариант 4 (pass + id + encoded_name):</span>
                <span class="info-value"><code>{{ debug_info.variant4 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v4 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v4 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            
            {% if debug_info.variant5 != 'N/A' %}
            <div class="info-row">
                <span class="info-label">Вариант 5 (pass + cp1251_decoded_name + id):</span>
                <span class="info-value"><code>{{ debug_info.variant5 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v5 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v5 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            {% endif %}
            
            {% if debug_info.variant_latin1_bytes != 'N/A' %}
            <div class="info-row">
                <span class="info-label">Вариант LATIN1_BYTES (pass + latin1_bytes + id):</span>
                <span class="info-value"><code>{{ debug_info.variant_latin1_bytes }}</code></span>
                <span style="color: {% if debug_info.sign_match_latin1_bytes %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_latin1_bytes %}✅{% else %}❌{% endif %}
                </span>
            </div>
            {% endif %}
            
            {% if debug_info.variant6 != 'N/A' %}
            <div class="info-row">
                <span class="info-label">Вариант 6 (pass + re-encoded_name + id):</span>
                <span class="info-value"><code>{{ debug_info.variant6 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v6 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v6 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            {% endif %}
            
            {% if debug_info.variant7 != 'N/A' %}
            <div class="info-row">
                <span class="info-label">Вариант 7 (pass + name_from_args + id):</span>
                <span class="info-value"><code>{{ debug_info.variant7 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v7 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v7 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            {% endif %}
            
            {% if debug_info.variant8 != 'N/A' %}
            <div class="info-row">
                <span class="info-label">Вариант 8 (pass + empty_string + id):</span>
                <span class="info-value"><code>{{ debug_info.variant8 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v8 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v8 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            {% endif %}
            
            {% if debug_info.variant9 != 'N/A' %}
            <div class="info-row">
                <span class="info-label">Вариант 9 (pass + id + empty_string):</span>
                <span class="info-value"><code>{{ debug_info.variant9 }}</code></span>
                <span style="color: {% if debug_info.sign_match_v9 %}var(--success-color){% else %}var(--error-color){% endif %}; margin-left: 10px;">
                    {% if debug_info.sign_match_v9 %}✅{% else %}❌{% endif %}
                </span>
            </div>
            {% endif %}
            
            <div class="info-row">
                <span class="info-label">Полученная подпись от GWars:</span>
                <span class="info-value"><code style="font-weight: bold;">{{ debug_info.received_sign }}</code></span>
            </div>
            
            <h3>Проверка подписи sign2:</h3>
            <div class="info-row">
                <span class="info-label">Ожидаемая подпись:</span>
                <span class="info-value"><code>{{ debug_info.expected_sign2 }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Полученная подпись:</span>
                <span class="info-value"><code>{{ debug_info.received_sign2 }}</code></span>
            </div>
            <div class="info-row">
                <span class="info-label">Совпадение:</span>
                <span class="info-value" style="color: {% if debug_info.sign2_match %}var(--success-color){% else %}var(--error-color){% endif %};">
                    {% if debug_info.sign2_match %}✅ Да{% else %}❌ Нет{% endif %}
                </span>
            </div>
            
            <h3>Все параметры (JSON):</h3>
            <pre style="background: var(--bg-secondary); padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 0.9rem;">{{ debug_info.received_params | tojson(indent=2) }}</pre>
        </div>
        {% else %}
        <p>Нет параметров для отладки. Перейдите по ссылке с параметрами от GWars.</p>
        <p>Или используйте: <a href="{{ url_for('login') }}">/login</a> для авторизации через GWars</p>
        {% endif %}
    </div>
</div>
{% endblock %}

