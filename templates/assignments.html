{% extends "base.html" %}

{% block title %}–ó–∞–¥–∞–Ω–∏—è - –ê–Ω–æ–Ω–∏–º–Ω—ã–µ –î–µ–¥—ã –ú–æ—Ä–æ–∑—ã{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="admin-container">
        <div class="admin-header">
            <h1>üìã –ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</h1>
        </div>
        
        {% if assignments_by_event %}
            {% for event_id, event_data in assignments_by_event.items() %}
            <div class="event-view-card" style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">{{ event_data.event_name }}</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <!-- –ì–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –î–µ–¥ –ú–æ—Ä–æ–∑ -->
                    {% if event_data.as_santa %}
                    <div class="assignment-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <span style="font-size: 2rem; margin-right: 0.5rem;">üéÖ</span>
                            <h3 style="margin: 0; color: white;">–í—ã - –î–µ–¥ –ú–æ—Ä–æ–∑</h3>
                        </div>
                        <p style="margin-bottom: 1rem; opacity: 0.9;">–í—ã –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫:</p>
                        <div style="background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <p style="margin: 0.5rem 0;"><strong>–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</strong> {{ event_data.as_santa.get('recipient_username', '‚Äî') }}</p>
                            {% if event_data.as_santa.get('recipient_last_name') or event_data.as_santa.get('recipient_first_name') %}
                            <p style="margin: 0.5rem 0;">
                                <strong>–§–ò–û:</strong> 
                                {{ event_data.as_santa.get('recipient_last_name', '') }} 
                                {{ event_data.as_santa.get('recipient_first_name', '') }} 
                                {{ event_data.as_santa.get('recipient_middle_name', '') }}
                            </p>
                            {% endif %}
                            {% if event_data.as_santa.get('recipient_postal_code') %}
                            <p style="margin: 0.5rem 0;">
                                <strong>–ê–¥—Ä–µ—Å:</strong><br>
                                {{ event_data.as_santa.get('recipient_postal_code', '') }}, 
                                {{ event_data.as_santa.get('recipient_country', '') }}, 
                                {{ event_data.as_santa.get('recipient_city', '') }}, 
                                {{ event_data.as_santa.get('recipient_street', '') }}, 
                                –¥. {{ event_data.as_santa.get('recipient_house', '') }}
                                {% if event_data.as_santa.get('recipient_building') %}, –∫–æ—Ä–ø. {{ event_data.as_santa.get('recipient_building') }}{% endif %}
                                {% if event_data.as_santa.get('recipient_apartment') %}, –∫–≤. {{ event_data.as_santa.get('recipient_apartment') }}{% endif %}
                            </p>
                            {% endif %}
                        </div>
                        
                        {% if event_data.as_santa.get('santa_sent_at') %}
                        <div style="background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 8px;">
                            <p style="margin: 0.5rem 0;"><strong>–°—Ç–∞—Ç—É—Å:</strong> –ü–æ–¥–∞—Ä–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω {{ event_data.as_santa.get('santa_sent_at') }}</p>
                            {% if event_data.as_santa.get('santa_send_info') %}
                            <p style="margin: 0.5rem 0; white-space: pre-wrap;"><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ:</strong><br>{{ event_data.as_santa.get('santa_send_info') }}</p>
                            {% endif %}
                        </div>
                        {% else %}
                        <form method="POST" action="{{ url_for('assignment_mark_sent', assignment_id=event_data.as_santa.get('id')) }}" style="margin-top: 1rem;">
                            <label for="send_info_{{ event_data.as_santa.get('id') }}" style="display: block; margin-bottom: 0.5rem; color: rgba(255,255,255,0.8); font-weight: 600;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ</label>
                            <textarea 
                                id="send_info_{{ event_data.as_santa.get('id') }}"
                                name="send_info"
                                class="setting-input"
                                style="width: 100%; border-radius: 8px; border: none; padding: 0.75rem; resize: vertical; min-height: 100px;"
                                placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä, –¥–∞—Ç–∞, —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –¥—Ä.)"
                                maxlength="500"
                                required
                            ></textarea>
                            <button type="submit" class="btn btn-light" style="margin-top: 0.75rem;">–û—Ç–ø—Ä–∞–≤–∏–ª</button>
                            <p style="margin-top: 0.5rem; font-size: 0.85rem; opacity: 0.8;">–ú–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤</p>
                        </form>
                        {% endif %}
                    </div>
                    {% else %}
                    <div class="assignment-card" style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; border: 2px dashed var(--border-color); text-align: center; color: var(--text-secondary);">
                        <span style="font-size: 2rem; display: block; margin-bottom: 0.5rem;">üéÖ</span>
                        <p style="margin: 0;">–í—ã –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –î–µ–¥–æ–º –ú–æ—Ä–æ–∑–æ–º</p>
                    </div>
                    {% endif %}
                    
                    <!-- –ì–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –í–Ω—É—á–∫–∞ -->
                    {% if event_data.as_recipient %}
                    <div class="assignment-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 1.5rem; border-radius: 12px;">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <span style="font-size: 2rem; margin-right: 0.5rem;">üéÅ</span>
                            <h3 style="margin: 0; color: white;">–í—ã - –í–Ω—É—á–∫–∞</h3>
                        </div>
                        <p style="margin-bottom: 1rem; opacity: 0.9;">–í–∞–º –æ—Ç–ø—Ä–∞–≤–∏—Ç –ø–æ–¥–∞—Ä–æ–∫:</p>
                        <div style="background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 8px;">
                            <p style="margin: 0.5rem 0;"><strong>–î–µ–¥ –ú–æ—Ä–æ–∑:</strong> {{ event_data.as_recipient.get('santa_username', '‚Äî') }}</p>
                            <p style="margin: 0.5rem 0; opacity: 0.8;">(–∏–º—è —Å–∫—Ä—ã—Ç–æ –¥–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞)</p>
                            {% if event_data.as_recipient.get('santa_sent_at') %}
                            <p style="margin: 0.5rem 0;"><strong>–°—Ç–∞—Ç—É—Å:</strong> –í–∞–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–¥–∞—Ä–æ–∫ {{ event_data.as_recipient.get('santa_sent_at') }}</p>
                            {% if event_data.as_recipient.get('santa_send_info') %}
                            <p style="margin: 0.5rem 0; white-space: pre-wrap;"><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞:</strong><br>{{ event_data.as_recipient.get('santa_send_info') }}</p>
                            {% endif %}
                            
                            {% if event_data.as_recipient.get('recipient_received_at') %}
                            <p style="margin: 0.5rem 0;"><strong>–í—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏–µ:</strong> {{ event_data.as_recipient.get('recipient_received_at') }}</p>
                            {% else %}
                            <form method="POST" action="{{ url_for('assignment_mark_received', assignment_id=event_data.as_recipient.get('id')) }}" style="margin-top: 0.75rem;">
                                <button type="submit" class="btn btn-light">–ü–æ–ª—É—á–∏–ª</button>
                            </form>
                            {% endif %}
                            {% else %}
                            <p style="margin: 0.5rem 0; opacity: 0.8;">–î–∞—Ä–∏—Ç–µ–ª—å –µ—â–µ –Ω–µ –æ—Ç–º–µ—Ç–∏–ª –æ—Ç–ø—Ä–∞–≤–∫—É –ø–æ–¥–∞—Ä–∫–∞</p>
                            {% endif %}
                        </div>
                    </div>
                    {% else %}
                    <div class="assignment-card" style="background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; border: 2px dashed var(--border-color); text-align: center; color: var(--text-secondary);">
                        <span style="font-size: 2rem; display: block; margin-bottom: 0.5rem;">üéÅ</span>
                        <p style="margin: 0;">–í—ã –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º –ø–æ–¥–∞—Ä–∫–∞</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
        <div class="empty-state">
            <p style="font-size: 1.2rem; color: var(--text-secondary); text-align: center; padding: 3rem;">
                –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞–Ω–∏–π. –ó–∞–¥–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
            </p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

